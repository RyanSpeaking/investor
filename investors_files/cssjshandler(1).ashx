
(function(N,d,p,K,k,H){var b=this;var n=Math.floor(Math.random()*10000);var q=Function.prototype;var Q=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/;var R=/[\-\w]+\/\.\.\//;var F=/([^:])\/\//g;var I="";var o={};var M=N.easyXDM;var U="easyXDM_";var E;var y=false;var i;var h;function C(X,Z){var Y=typeof X[Z];return Y=="function"||(!!(Y=="object"&&X[Z]))||Y=="unknown"}function u(X,Y){return!!(typeof(X[Y])=="object"&&X[Y])}function r(X){return Object.prototype.toString.call(X)==="[object Array]"}function c(){var Z="Shockwave Flash",ad="application/x-shockwave-flash";if(!t(navigator.plugins)&&typeof navigator.plugins[Z]=="object"){var ab=navigator.plugins[Z].description;if(ab&&!t(navigator.mimeTypes)&&navigator.mimeTypes[ad]&&navigator.mimeTypes[ad].enabledPlugin){i=ab.match(/\d+/g)}}if(!i){var Y;try{Y=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");i=Array.prototype.slice.call(Y.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1);Y=null}catch(ac){}}if(!i){return false}var X=parseInt(i[0],10),aa=parseInt(i[1],10);h=X>9&&aa>0;return true}var v,x;if(C(N,"addEventListener")){v=function(Z,X,Y){Z.addEventListener(X,Y,false)};x=function(Z,X,Y){Z.removeEventListener(X,Y,false)}}else{if(C(N,"attachEvent")){v=function(X,Z,Y){X.attachEvent("on"+Z,Y)};x=function(X,Z,Y){X.detachEvent("on"+Z,Y)}}else{throw new Error("Browser not supported")}}var W=false,J=[],L;if("readyState"in d){L=d.readyState;W=L=="complete"||(~navigator.userAgent.indexOf("AppleWebKit/")&&(L=="loaded"||L=="interactive"))}else{W=!!d.body}function s(){if(W){return}W=true;for(var X=0;X<J.length;X++){J[X]()}J.length=0}if(!W){if(C(N,"addEventListener")){v(d,"DOMContentLoaded",s)}else{v(d,"readystatechange",function(){if(d.readyState=="complete"){s()}});if(d.documentElement.doScroll&&N===top){var g=function(){if(W){return}try{d.documentElement.doScroll("left")}catch(X){K(g,1);return}s()};g()}}v(N,"load",s)}function G(Y,X){if(W){Y.call(X);return}J.push(function(){Y.call(X)})}function m(){var Z=parent;if(I!==""){for(var X=0,Y=I.split(".");X<Y.length;X++){Z=Z[Y[X]]}}return Z.easyXDM}function e(X){N.easyXDM=M;I=X;if(I){U="easyXDM_"+I.replace(".","_")+"_"}return o}function z(X){return X.match(Q)[3]}function f(X){return X.match(Q)[4]||""}function j(Z){var X=Z.toLowerCase().match(Q);var aa=X[2],ab=X[3],Y=X[4]||"";if((aa=="http:"&&Y==":80")||(aa=="https:"&&Y==":443")){Y=""}return aa+"//"+ab+Y}function B(X){X=X.replace(F,"$1/");if(!X.match(/^(http||https):\/\//)){var Y=(X.substring(0,1)==="/")?"":p.pathname;if(Y.substring(Y.length-1)!=="/"){Y=Y.substring(0,Y.lastIndexOf("/")+1)}X=p.protocol+"//"+p.host+Y+X}while(R.test(X)){X=X.replace(R,"")}return X}function P(X,aa){var ac="",Z=X.indexOf("#");if(Z!==-1){ac=X.substring(Z);X=X.substring(0,Z)}var ab=[];for(var Y in aa){if(aa.hasOwnProperty(Y)){ab.push(Y+"="+H(aa[Y]))}}return X+(y?"#":(X.indexOf("?")==-1?"?":"&"))+ab.join("&")+ac}var S=(function(X){X=X.substring(1).split("&");var Z={},aa,Y=X.length;while(Y--){aa=X[Y].split("=");Z[aa[0]]=k(aa[1])}return Z}(/xdm_e=/.test(p.search)?p.search:p.hash));function t(X){return typeof X==="undefined"}var O=function(){var Y={};var Z={a:[1,2,3]},X='{"a":[1,2,3]}';if(typeof JSON!="undefined"&&typeof JSON.stringify==="function"&&JSON.stringify(Z).replace((/\s/g),"")===X){return JSON}if(Object.toJSON){if(Object.toJSON(Z).replace((/\s/g),"")===X){Y.stringify=Object.toJSON}}if(typeof String.prototype.evalJSON==="function"){Z=X.evalJSON();if(Z.a&&Z.a.length===3&&Z.a[2]===3){Y.parse=function(aa){return aa.evalJSON()}}}if(Y.stringify&&Y.parse){O=function(){return Y};return Y}return null};function T(X,Y,Z){var ab;for(var aa in Y){if(Y.hasOwnProperty(aa)){if(aa in X){ab=Y[aa];if(typeof ab==="object"){T(X[aa],ab,Z)}else{if(!Z){X[aa]=Y[aa]}}}else{X[aa]=Y[aa]}}}return X}function a(){var Y=d.body.appendChild(d.createElement("form")),X=Y.appendChild(d.createElement("input"));X.name=U+"TEST"+n;E=X!==Y.elements[X.name];d.body.removeChild(Y)}function A(Y){if(t(E)){a()}var ac;if(E){ac=d.createElement('<iframe name="'+Y.props.name+'"/>')}else{ac=d.createElement("IFRAME");ac.name=Y.props.name}ac.id=ac.name=Y.props.name;delete Y.props.name;if(typeof Y.container=="string"){Y.container=d.getElementById(Y.container)}if(!Y.container){T(ac.style,{position:"absolute",top:"-2000px",left:"0px"});Y.container=d.body}var ab=Y.props.src;Y.props.src="javascript:false";T(ac,Y.props);ac.border=ac.frameBorder=0;ac.allowTransparency=true;Y.container.appendChild(ac);if(Y.onLoad){v(ac,"load",Y.onLoad)}if(Y.usePost){var aa=Y.container.appendChild(d.createElement("form")),X;aa.target=ac.name;aa.action=ab;aa.method="POST";if(typeof(Y.usePost)==="object"){for(var Z in Y.usePost){if(Y.usePost.hasOwnProperty(Z)){if(E){X=d.createElement('<input name="'+Z+'"/>')}else{X=d.createElement("INPUT");X.name=Z}X.value=Y.usePost[Z];aa.appendChild(X)}}}aa.submit();aa.parentNode.removeChild(aa)}else{ac.src=ab}Y.props.src=ab;return ac}function V(aa,Z){if(typeof aa=="string"){aa=[aa]}var Y,X=aa.length;while(X--){Y=aa[X];Y=new RegExp(Y.substr(0,1)=="^"?Y:("^"+Y.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"));if(Y.test(Z)){return true}}return false}function l(Z){var ae=Z.protocol,Y;Z.isHost=Z.isHost||t(S.xdm_p);y=Z.hash||false;if(!Z.props){Z.props={}}if(!Z.isHost){Z.channel=S.xdm_c.replace(/["'<>\\]/g,"");Z.secret=S.xdm_s;Z.remote=S.xdm_e.replace(/["'<>\\]/g,"");ae=S.xdm_p;if(Z.acl&&!V(Z.acl,Z.remote)){throw new Error("Access denied for "+Z.remote)}}else{Z.remote=B(Z.remote);Z.channel=Z.channel||"default"+n++;Z.secret=Math.random().toString(16).substring(2);if(t(ae)){if(j(p.href)==j(Z.remote)){ae="4"}else{if(C(N,"postMessage")||C(d,"postMessage")){ae="1"}else{if(Z.swf&&C(N,"ActiveXObject")&&c()){ae="6"}else{if(navigator.product==="Gecko"&&"frameElement"in N&&navigator.userAgent.indexOf("WebKit")==-1){ae="5"}else{if(Z.remoteHelper){ae="2"}else{ae="0"}}}}}}}Z.protocol=ae;switch(ae){case"0":T(Z,{interval:100,delay:2000,useResize:true,useParent:false,usePolling:false},true);if(Z.isHost){if(!Z.local){var ac=p.protocol+"//"+p.host,X=d.body.getElementsByTagName("img"),ad;var aa=X.length;while(aa--){ad=X[aa];if(ad.src.substring(0,ac.length)===ac){Z.local=ad.src;break}}if(!Z.local){Z.local=N}}var ab={xdm_c:Z.channel,xdm_p:0};if(Z.local===N){Z.usePolling=true;Z.useParent=true;Z.local=p.protocol+"//"+p.host+p.pathname+p.search;ab.xdm_e=Z.local;ab.xdm_pa=1}else{ab.xdm_e=B(Z.local)}if(Z.container){Z.useResize=false;ab.xdm_po=1}Z.remote=P(Z.remote,ab)}else{T(Z,{channel:S.xdm_c,remote:S.xdm_e,useParent:!t(S.xdm_pa),usePolling:!t(S.xdm_po),useResize:Z.useParent?false:Z.useResize})}Y=[new o.stack.HashTransport(Z),new o.stack.ReliableBehavior({}),new o.stack.QueueBehavior({encode:true,maxLength:4000-Z.remote.length}),new o.stack.VerifyBehavior({initiate:Z.isHost})];break;case"1":Y=[new o.stack.PostMessageTransport(Z)];break;case"2":if(Z.isHost){Z.remoteHelper=B(Z.remoteHelper)}Y=[new o.stack.NameTransport(Z),new o.stack.QueueBehavior(),new o.stack.VerifyBehavior({initiate:Z.isHost})];break;case"3":Y=[new o.stack.NixTransport(Z)];break;case"4":Y=[new o.stack.SameOriginTransport(Z)];break;case"5":Y=[new o.stack.FrameElementTransport(Z)];break;case"6":if(!i){c()}Y=[new o.stack.FlashTransport(Z)];break}Y.push(new o.stack.QueueBehavior({lazy:Z.lazy,remove:true}));return Y}function D(aa){var ab,Z={incoming:function(ad,ac){this.up.incoming(ad,ac)},outgoing:function(ac,ad){this.down.outgoing(ac,ad)},callback:function(ac){this.up.callback(ac)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}};for(var Y=0,X=aa.length;Y<X;Y++){ab=aa[Y];T(ab,Z,true);if(Y!==0){ab.down=aa[Y-1]}if(Y!==X-1){ab.up=aa[Y+1]}}return ab}function w(X){X.up.down=X.down;X.down.up=X.up;X.up=X.down=null}T(o,{version:"2.4.19.3",query:S,stack:{},apply:T,getJSONObject:O,whenReady:G,noConflict:e});o.DomHelper={on:v,un:x,requiresJSON:function(X){if(!u(N,"JSON")){d.write('<script type="text/javascript" src="'+X+'"><\/script>')}}};(function(){var X={};o.Fn={set:function(Y,Z){X[Y]=Z},get:function(Z,Y){if(!X.hasOwnProperty(Z)){return}var aa=X[Z];if(Y){delete X[Z]}return aa}}}());o.Socket=function(Y){var X=D(l(Y).concat([{incoming:function(ab,aa){Y.onMessage(ab,aa)},callback:function(aa){if(Y.onReady){Y.onReady(aa)}}}])),Z=j(Y.remote);this.origin=j(Y.remote);this.destroy=function(){X.destroy()};this.postMessage=function(aa){X.outgoing(aa,Z)};X.init()};o.Rpc=function(Z,Y){if(Y.local){for(var ab in Y.local){if(Y.local.hasOwnProperty(ab)){var aa=Y.local[ab];if(typeof aa==="function"){Y.local[ab]={method:aa}}}}}var X=D(l(Z).concat([new o.stack.RpcBehavior(this,Y),{callback:function(ac){if(Z.onReady){Z.onReady(ac)}}}]));this.origin=j(Z.remote);this.destroy=function(){X.destroy()};X.init()};o.stack.SameOriginTransport=function(Y){var Z,ab,aa,X;return(Z={outgoing:function(ad,ae,ac){aa(ad);if(ac){ac()}},destroy:function(){if(ab){ab.parentNode.removeChild(ab);ab=null}},onDOMReady:function(){X=j(Y.remote);if(Y.isHost){T(Y.props,{src:P(Y.remote,{xdm_e:p.protocol+"//"+p.host+p.pathname,xdm_c:Y.channel,xdm_p:4}),name:U+Y.channel+"_provider"});ab=A(Y);o.Fn.set(Y.channel,function(ac){aa=ac;K(function(){Z.up.callback(true)},0);return function(ad){Z.up.incoming(ad,X)}})}else{aa=m().Fn.get(Y.channel,true)(function(ac){Z.up.incoming(ac,X)});K(function(){Z.up.callback(true)},0)}},init:function(){G(Z.onDOMReady,Z)}})};o.stack.FlashTransport=function(aa){var ac,X,ab,ad,Y,ae;function af(ah,ag){K(function(){ac.up.incoming(ah,ad)},0)}function Z(ah){var ag=aa.swf+"?host="+aa.isHost;var aj="easyXDM_swf_"+Math.floor(Math.random()*10000);o.Fn.set("flash_loaded"+ah.replace(/[\-.]/g,"_"),function(){o.stack.FlashTransport[ah].swf=Y=ae.firstChild;var ak=o.stack.FlashTransport[ah].queue;for(var al=0;al<ak.length;al++){ak[al]()}ak.length=0});if(aa.swfContainer){ae=(typeof aa.swfContainer=="string")?d.getElementById(aa.swfContainer):aa.swfContainer}else{ae=d.createElement("div");T(ae.style,h&&aa.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0});d.body.appendChild(ae)}var ai="callback=flash_loaded"+H(ah.replace(/[\-.]/g,"_"))+"&proto="+b.location.protocol+"&domain="+H(z(b.location.href))+"&port="+H(f(b.location.href))+"&ns="+H(I);ae.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+aj+"' data='"+ag+"'><param name='allowScriptAccess' value='always'></param><param name='wmode' value='transparent'><param name='movie' value='"+ag+"'></param><param name='flashvars' value='"+ai+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+ai+"' allowScriptAccess='always' wmode='transparent' src='"+ag+"' height='1' width='1'></embed></object>"}return(ac={outgoing:function(ah,ai,ag){Y.postMessage(aa.channel,ah.toString());if(ag){ag()}},destroy:function(){try{Y.destroyChannel(aa.channel)}catch(ag){}Y=null;if(X){X.parentNode.removeChild(X);X=null}},onDOMReady:function(){ad=aa.remote;o.Fn.set("flash_"+aa.channel+"_init",function(){K(function(){ac.up.callback(true)})});o.Fn.set("flash_"+aa.channel+"_onMessage",af);aa.swf=B(aa.swf);var ah=z(aa.swf);var ag=function(){o.stack.FlashTransport[ah].init=true;Y=o.stack.FlashTransport[ah].swf;Y.createChannel(aa.channel,aa.secret,j(aa.remote),aa.isHost);if(aa.isHost){if(h&&aa.swfNoThrottle){T(aa.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"})}T(aa.props,{src:P(aa.remote,{xdm_e:j(p.href),xdm_c:aa.channel,xdm_p:6,xdm_s:aa.secret}),name:U+aa.channel+"_provider"});X=A(aa)}};if(o.stack.FlashTransport[ah]&&o.stack.FlashTransport[ah].init){ag()}else{if(!o.stack.FlashTransport[ah]){o.stack.FlashTransport[ah]={queue:[ag]};Z(ah)}else{o.stack.FlashTransport[ah].queue.push(ag)}}},init:function(){G(ac.onDOMReady,ac)}})};o.stack.PostMessageTransport=function(aa){var ac,ad,Y,Z;function X(ae){if(ae.origin){return j(ae.origin)}if(ae.uri){return j(ae.uri)}if(ae.domain){return p.protocol+"//"+ae.domain}throw"Unable to retrieve the origin of the event"}function ab(af){var ae=X(af);if(ae==Z&&af.data.substring(0,aa.channel.length+1)==aa.channel+" "){ac.up.incoming(af.data.substring(aa.channel.length+1),ae)}}return(ac={outgoing:function(af,ag,ae){Y.postMessage(aa.channel+" "+af,ag||Z);if(ae){ae()}},destroy:function(){x(N,"message",ab);if(ad){Y=null;ad.parentNode.removeChild(ad);ad=null}},onDOMReady:function(){Z=j(aa.remote);if(aa.isHost){var ae=function(af){if(af.data==aa.channel+"-ready"){Y=("postMessage"in ad.contentWindow)?ad.contentWindow:ad.contentWindow.document;x(N,"message",ae);v(N,"message",ab);K(function(){ac.up.callback(true)},0)}};v(N,"message",ae);T(aa.props,{src:P(aa.remote,{xdm_e:j(p.href),xdm_c:aa.channel,xdm_p:1}),name:U+aa.channel+"_provider"});ad=A(aa)}else{v(N,"message",ab);Y=("postMessage"in N.parent)?N.parent:N.parent.document;Y.postMessage(aa.channel+"-ready",Z);K(function(){ac.up.callback(true)},0)}},init:function(){G(ac.onDOMReady,ac)}})};o.stack.FrameElementTransport=function(Y){var Z,ab,aa,X;return(Z={outgoing:function(ad,ae,ac){aa.call(this,ad);if(ac){ac()}},destroy:function(){if(ab){ab.parentNode.removeChild(ab);ab=null}},onDOMReady:function(){X=j(Y.remote);if(Y.isHost){T(Y.props,{src:P(Y.remote,{xdm_e:j(p.href),xdm_c:Y.channel,xdm_p:5}),name:U+Y.channel+"_provider"});ab=A(Y);ab.fn=function(ac){delete ab.fn;aa=ac;K(function(){Z.up.callback(true)},0);return function(ad){Z.up.incoming(ad,X)}}}else{if(d.referrer&&j(d.referrer)!=S.xdm_e){N.top.location=S.xdm_e}aa=N.frameElement.fn(function(ac){Z.up.incoming(ac,X)});Z.up.callback(true)}},init:function(){G(Z.onDOMReady,Z)}})};o.stack.NameTransport=function(ab){var ac;var ae,ai,aa,ag,ah,Y,X;function af(al){var ak=ab.remoteHelper+(ae?"#_3":"#_2")+ab.channel;ai.contentWindow.sendMessage(al,ak)}function ad(){if(ae){if(++ag===2||!ae){ac.up.callback(true)}}else{af("ready");ac.up.callback(true)}}function aj(ak){ac.up.incoming(ak,Y)}function Z(){if(ah){K(function(){ah(true)},0)}}return(ac={outgoing:function(al,am,ak){ah=ak;af(al)},destroy:function(){ai.parentNode.removeChild(ai);ai=null;if(ae){aa.parentNode.removeChild(aa);aa=null}},onDOMReady:function(){ae=ab.isHost;ag=0;Y=j(ab.remote);ab.local=B(ab.local);if(ae){o.Fn.set(ab.channel,function(al){if(ae&&al==="ready"){o.Fn.set(ab.channel,aj);ad()}});X=P(ab.remote,{xdm_e:ab.local,xdm_c:ab.channel,xdm_p:2});T(ab.props,{src:X+"#"+ab.channel,name:U+ab.channel+"_provider"});aa=A(ab)}else{ab.remoteHelper=ab.remote;o.Fn.set(ab.channel,aj)}var ak=function(){var al=ai||this;x(al,"load",ak);o.Fn.set(ab.channel+"_load",Z);(function am(){if(typeof al.contentWindow.sendMessage=="function"){ad()}else{K(am,50)}}())};ai=A({props:{src:ab.local+"#_4"+ab.channel},onLoad:ak})},init:function(){G(ac.onDOMReady,ac)}})};o.stack.HashTransport=function(Z){var ac;var ah=this,af,aa,X,ad,am,ab,al;var ag,Y;function ak(ao){if(!al){return}var an=Z.remote+"#"+(am++)+"_"+ao;((af||!ag)?al.contentWindow:al).location=an}function ae(an){ad=an;ac.up.incoming(ad.substring(ad.indexOf("_")+1),Y)}function aj(){if(!ab){return}var an=ab.location.href,ap="",ao=an.indexOf("#");if(ao!=-1){ap=an.substring(ao)}if(ap&&ap!=ad){ae(ap)}}function ai(){aa=setInterval(aj,X)}return(ac={outgoing:function(an,ao){ak(an)},destroy:function(){N.clearInterval(aa);if(af||!ag){al.parentNode.removeChild(al)}al=null},onDOMReady:function(){af=Z.isHost;X=Z.interval;ad="#"+Z.channel;am=0;ag=Z.useParent;Y=j(Z.remote);if(af){T(Z.props,{src:Z.remote,name:U+Z.channel+"_provider"});if(ag){Z.onLoad=function(){ab=N;ai();ac.up.callback(true)}}else{var ap=0,an=Z.delay/50;(function ao(){if(++ap>an){throw new Error("Unable to reference listenerwindow")}try{ab=al.contentWindow.frames[U+Z.channel+"_consumer"]}catch(aq){}if(ab){ai();ac.up.callback(true)}else{K(ao,50)}}())}al=A(Z)}else{ab=N;ai();if(ag){al=parent;ac.up.callback(true)}else{T(Z,{props:{src:Z.remote+"#"+Z.channel+new Date(),name:U+Z.channel+"_consumer"},onLoad:function(){ac.up.callback(true)}});al=A(Z)}}},init:function(){G(ac.onDOMReady,ac)}})};o.stack.ReliableBehavior=function(Y){var aa,ac;var ab=0,X=0,Z="";return(aa={incoming:function(af,ad){var ae=af.indexOf("_"),ag=af.substring(0,ae).split(",");af=af.substring(ae+1);if(ag[0]==ab){Z="";if(ac){ac(true)}}if(af.length>0){aa.down.outgoing(ag[1]+","+ab+"_"+Z,ad);if(X!=ag[1]){X=ag[1];aa.up.incoming(af,ad)}}},outgoing:function(af,ad,ae){Z=af;ac=ae;aa.down.outgoing(X+","+(++ab)+"_"+af,ad)}})};o.stack.QueueBehavior=function(Z){var ac,ad=[],ag=true,aa="",af,X=0,Y=false,ab=false;function ae(){if(Z.remove&&ad.length===0){w(ac);return}if(ag||ad.length===0||af){return}ag=true;var ah=ad.shift();ac.down.outgoing(ah.data,ah.origin,function(ai){ag=false;if(ah.callback){K(function(){ah.callback(ai)},0)}ae()})}return(ac={init:function(){if(t(Z)){Z={}}if(Z.maxLength){X=Z.maxLength;ab=true}if(Z.lazy){Y=true}else{ac.down.init()}},callback:function(ai){ag=false;var ah=ac.up;ae();ah.callback(ai)},incoming:function(ak,ai){if(ab){var aj=ak.indexOf("_"),ah=parseInt(ak.substring(0,aj),10);aa+=ak.substring(aj+1);if(ah===0){if(Z.encode){aa=k(aa)}ac.up.incoming(aa,ai);aa=""}}else{ac.up.incoming(ak,ai)}},outgoing:function(al,ai,ak){if(Z.encode){al=H(al)}var ah=[],aj;if(ab){while(al.length!==0){aj=al.substring(0,X);al=al.substring(aj.length);ah.push(aj)}while((aj=ah.shift())){ad.push({data:ah.length+"_"+aj,origin:ai,callback:ah.length===0?ak:null})}}else{ad.push({data:al,origin:ai,callback:ak})}if(Y){ac.down.init()}else{ae()}},destroy:function(){af=true;ac.down.destroy()}})};o.stack.VerifyBehavior=function(ab){var ac,aa,Y,Z=false;function X(){aa=Math.random().toString(16).substring(2);ac.down.outgoing(aa)}return(ac={incoming:function(af,ad){var ae=af.indexOf("_");if(ae===-1){if(af===aa){ac.up.callback(true)}else{if(!Y){Y=af;if(!ab.initiate){X()}ac.down.outgoing(af)}}}else{if(af.substring(0,ae)===Y){ac.up.incoming(af.substring(ae+1),ad)}}},outgoing:function(af,ad,ae){ac.down.outgoing(aa+"_"+af,ad,ae)},callback:function(ad){if(ab.initiate){X()}}})};o.stack.RpcBehavior=function(ad,Y){var aa,af=Y.serializer||O();var ae=0,ac={};function X(ag){ag.jsonrpc="2.0";aa.down.outgoing(af.stringify(ag))}function ab(ag,ai){var ah=Array.prototype.slice;return function(){var aj=arguments.length,al,ak={method:ai};if(aj>0&&typeof arguments[aj-1]==="function"){if(aj>1&&typeof arguments[aj-2]==="function"){al={success:arguments[aj-2],error:arguments[aj-1]};ak.params=ah.call(arguments,0,aj-2)}else{al={success:arguments[aj-1]};ak.params=ah.call(arguments,0,aj-1)}ac[""+(++ae)]=al;ak.id=ae}else{ak.params=ah.call(arguments,0)}if(ag.namedParams&&ak.params.length===1){ak.params=ak.params[0]}X(ak)}}function Z(an,am,ai,al){if(!ai){if(am){X({id:am,error:{code:-32601,message:"Procedure not found."}})}return}var ak,ah;if(am){ak=function(ao){ak=q;X({id:am,result:ao})};ah=function(ao,ap){ah=q;var aq={id:am,error:{code:-32099,message:ao}};if(ap){aq.error.data=ap}X(aq)}}else{ak=ah=q}if(!r(al)){al=[al]}try{var ag=ai.method.apply(ai.scope,al.concat([ak,ah]));if(!t(ag)){ak(ag)}}catch(aj){ah(aj.message)}}return(aa={incoming:function(ah,ag){var ai=af.parse(ah);if(ai.method){if(Y.handle){Y.handle(ai,X)}else{Z(ai.method,ai.id,Y.local[ai.method],ai.params)}}else{var aj=ac[ai.id];if(ai.error){if(aj.error){aj.error(ai.error)}}else{if(aj.success){aj.success(ai.result)}}delete ac[ai.id]}},init:function(){if(Y.remote){for(var ag in Y.remote){if(Y.remote.hasOwnProperty(ag)){ad[ag]=ab(Y.remote[ag],ag)}}}aa.down.init()},destroy:function(){for(var ag in Y.remote){if(Y.remote.hasOwnProperty(ag)&&ad.hasOwnProperty(ag)){delete ad[ag]}}aa.down.destroy()}})};b.easyXDM=o})(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent);if(!this.JSON){this.JSON={};}
(function(){function f(n){return n<10?'0'+n:n;}
if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+
f(this.getUTCDate())+'T'+
f(this.getUTCHours())+':'+
f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z':null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}
var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}
function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}
if(typeof rep==='function'){value=rep.call(holder,key,value);}
switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}
gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}
v=partial.length===0?'[]':gap?'[\n'+gap+
partial.join(',\n'+gap)+'\n'+
mind+']':'['+partial.join(',')+']';gap=mind;return v;}
if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==='string'){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}
v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+
mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}
if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}
rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}
return str('',{'':value});};}
if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}
return reviver.call(holder,key,value);}
text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+
('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}
if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}
throw new SyntaxError('JSON.parse');};}}());var MathCommon=new function()
{this.linearizeLog10=function(val)
{if(val>1.0e-6)
{return Math.log(val)/Math.LN10;}
return Math.log(1.0e-6)/Math.LN10;}
this.deLinearizeLog10=function(val)
{return MathCommon.round(Math.pow(10.0,val),2);}
this.round=function(val,digit)
{var factor=Math.pow(10,digit);return Math.round(val*factor)/factor;}
this.newGuid=function()
{var S4=function()
{return(((1+Math.random())*0x10000)|0).toString(16).substring(1);};return(S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4());}}
var msccut_utilsDate=new function()
{var monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];var monthShortNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var currentTimeZone=new Date().getTimezoneOffset();var MILLISECONDS_IN_MINUTE=60000;this.comapreDatePart=function(x,y)
{var xDate=new Date(x.getFullYear(),x.getMonth(),x.getDate());var yDate=new Date(y.getFullYear(),y.getMonth(),y.getDate());return xDate.getTime()==yDate.getTime();}
this.getMonthName=function(value,shortName)
{if(value&&value>0&&value<=12)
{return shortName?monthShortNames[value-1]:monthNames[value-1];}
return null;}
this.firstDayOfCurrentQuarter=function(dt)
{var currQuarter=Math.floor(dt.getMonth()/3);return new Date(dt.getFullYear(),3*currQuarter,1);}
this.prevDay=function(date)
{var pDate=new ServerDateTime();console.log(date);pDate.setTime(date.getTime()-86400000);console.log(pDate);return pDate;};this.firstDayOfCurrentMonth=function(dt){if(!dt){dt=new Date();var firstDay=new Date(dt.getFullYear(),dt.getMonth(),1);}};this.firstDayOfWeekInMonth=function(dt,dow)
{var firstDay=new Date(dt.getFullYear(),dt.getMonth(),1);var firstDow=firstDay.getDay();;var diff=dow-firstDow;if(diff<0)
diff+=7;firstDay.setDate(firstDay.getDate()+diff);return firstDay;}
this.dayOfWeekOfCurWeek=function(dt,dow)
{var shift=dow-dt.getDay();var newDate=new Date(dt);newDate.setDate(newDate.getDate()+shift);return newDate;}
this.getEastOffsetFromUTC=function(utcTime)
{var dayLightSTStartDate=this.getEastDSTStartDate();var dayLightSTEndDate=this.getEastDSTEndDate();if(utcTime>=dayLightSTStartDate&&utcTime<=dayLightSTEndDate)
return-4;return-5;}
this.getEastDSTEndDate=function()
{var dayLightSTEndDate=new Date(new Date().getFullYear(),11,1,2,0,0);while(dayLightSTEndDate.getUTCDay()!=0)
{dayLightSTEndDate.setDate(dayLightSTEndDate.getDate()-1);}
return dayLightSTEndDate;}
this.getEastDSTStartDate=function()
{var dayLightSTStartDate=new Date(new Date().getFullYear(),3,1,2,0,0);var sundayCount=0;while(true)
{if(dayLightSTStartDate.getUTCDay()!=0)
{sundayCount++;if(sundayCount==2)break;}
dayLightSTStartDate.setDate(dayLightSTStartDate.getDate()-1);;}
return dayLightSTStartDate;}
this.getTimeWithoutTimeZone=function(date)
{return date.getTime()-date.getTimezoneOffset()*MILLISECONDS_IN_MINUTE;}}
var DateUtils=(function(xxx){xxx.msc_format=function(date,format){var returnStr='';var replace=this.replaceChars(date);for(var i=0;i<format.length;i++){var curChar=format.charAt(i);if(i-1>=0&&format.charAt(i-1)=="\\"){returnStr+=curChar;}
else if(replace[curChar]){returnStr+=replace[curChar].call(date);}
else if(curChar!="\\"){returnStr+=curChar;}}
return returnStr;};xxx.replaceChars=function(date){return{shortMonths:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],longMonths:['January','February','March','April','May','June','July','August','September','October','November','December'],shortDays:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],longDays:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],d:function(){return(date.getDate()<10?'0':'')+date.getDate();},D:function(){return xxx.replaceChars(date).shortDays[date.getDay()];},j:function(){return date.getDate();},l:function(){return xxx.replaceChars(date).longDays[date.getDay()];},N:function(){return date.getDay()+1;},S:function(){return(date.getDate()%10==1&&date.getDate()!=11?'st':(date.getDate()%10==2&&date.getDate()!=12?'nd':(date.getDate()%10==3&&date.getDate()!=13?'rd':'th')));},w:function(){return date.getDay();},z:function(){var d=new Date(date.getFullYear(),0,1);return Math.ceil((date-d)/86400000);},W:function(){var d=new Date(date.getFullYear(),0,1);return Math.ceil((((date-d)/86400000)+d.getDay()+1)/7);},F:function(){return xxx.replaceChars(date).longMonths[date.getMonth()];},m:function(){return(date.getMonth()<9?'0':'')+(date.getMonth()+1);},M:function(){return xxx.replaceChars(date).shortMonths[date.getMonth()];},n:function(){return date.getMonth()+1;},t:function(){var d=new Date();return new Date(d.getFullYear(),d.getMonth(),0).getDate()},L:function(){var year=date.getFullYear();return(year%400==0||(year%100!=0&&year%4==0));},o:function(){var d=new Date(date.valueOf());d.setDate(d.getDate()-((date.getDay()+6)%7)+3);return d.getFullYear();},Y:function(){return date.getFullYear();},y:function(){return(''+date.getFullYear()).substr(2);},a:function(){return date.getHours()<12?'am':'pm';},A:function(){return date.getHours()<12?'AM':'PM';},B:function(){return Math.floor((((date.getUTCHours()+1)%24)+date.getUTCMinutes()/60+date.getUTCSeconds()/3600)*1000/24);},g:function(){return date.getHours()%12||12;},G:function(){return date.getHours();},h:function(){return((date.getHours()%12||12)<10?'0':'')+(date.getHours()%12||12);},H:function(){return(date.getHours()<10?'0':'')+date.getHours();},i:function(){return(date.getMinutes()<10?'0':'')+date.getMinutes();},s:function(){return(date.getSeconds()<10?'0':'')+date.getSeconds();},u:function(){var m=date.getMilliseconds();return(m<10?'00':(m<100?'0':''))+m;},e:function(){return"Not Yet Supported";},I:function(){return"Not Yet Supported";},O:function(){return(-date.getTimezoneOffset()<0?'-':'+')+(Math.abs(date.getTimezoneOffset()/60)<10?'0':'')+(Math.abs(date.getTimezoneOffset()/60))+'00';},P:function(){return(-date.getTimezoneOffset()<0?'-':'+')+(Math.abs(date.getTimezoneOffset()/60)<10?'0':'')+(Math.abs(date.getTimezoneOffset()/60))+':00';},T:function(){var m=date.getMonth();date.setMonth(0);var result=date.toTimeString().replace(/^.+ \(?([^\)]+)\)?$/,'$1');date.setMonth(m);return result;},Z:function(){return-date.getTimezoneOffset()*60;},c:function(){return xxx.msc_format("Y-m-d\\TH:i:sP");},r:function(){return date.toString();},U:function(){return date.getTime()/1000;}}};return xxx;}(DateUtils||{}));var datetimePageLoad=null;function ServerDateTime(){var currentDateTime=new Date();if(datetimePageLoad!=null){currentDateTime.setTime(datetimePageLoad.timeOffset+currentDateTime.getTime());}
return currentDateTime;}
function addCommas(nStr)
{nStr+='';x=nStr.split('.');x1=x[0];x2=x.length>1?'.'+x[1]:'';var rgx=/(\d+)(\d{3})/;while(rgx.test(x1))
{x1=x1.replace(rgx,'$1'+','+'$2');}
return x1+x2;}
var mscdpds_dictionaryHelper=new function()
{this.getDataByKey=function(dictionary,key)
{if(dictionary!=null&&dictionary.length>0)
{for(var i=0;i<dictionary.length;i++)
{if(dictionary[i].key==key)
{return dictionary[i].value;}}}
return null;}
this.addItem=function(dictionary,key,value)
{if(dictionary!=null)
{var objItem=new Object();objItem.key=key;objItem.value=value;dictionary.push(objItem);}}}
var mscdpds_datasourceHelper=new function(){var filterValidDatasource=function(dataSource){var res=[];for(var i=0;i<dataSource.length;i++){var sp=dataSource[i];if(sp!=null&&!sp.isInvalid&&sp.value!=null&&!isNaN(sp.value)&&sp.value>0){res.push(sp);}}
return res;}
var getFirstOrDefaultByArgument=function(dataSource,argument){for(var i=0;i<dataSource.length;i++){var sp=dataSource[i];if(sp.argument==argument){return sp;}}
return null;}
var getLastOrDefault=function(dataSource){if(dataSource!=null&&dataSource.length>0){return dataSource[dataSource.length-1];}
return new mscdp_seriesPoint();}
var getAverageValue=function(dataSource,count){if(count>0&&dataSource!=null&&dataSource.length>=count){var sum=0;for(var i=0;i<count;i++){sum+=dataSource[i].value;}
return sum/count;}
return NaN;}
this.createAverageSeries=function(source,destination,averageSizeNum,bBreakable,bIgnoreNoTrade,bIgnoreFirstTick){if(source==null||averageSizeNum<1||source.length<averageSizeNum-1){return;}
var validDataSource=bIgnoreNoTrade?filterValidDatasource(source):source;if(validDataSource.length<averageSizeNum){return;}
var DataSourceLength=bIgnoreFirstTick?validDataSource.length-1:validDataSource.length;var fSum=0;for(var i=0;i<DataSourceLength;i++){var validSeriesPoint=validDataSource[i];fSum+=validSeriesPoint.value;if(i>=averageSizeNum-1){var sp=getFirstOrDefaultByArgument(destination,validSeriesPoint.argument);if(sp!=null){sp.value=fSum/averageSizeNum;}
else{var objSeries=new mscdp_seriesPoint(validSeriesPoint.argument,fSum/averageSizeNum);destination.push(objSeries);}
fSum-=validDataSource[i+1-averageSizeNum].value;}}}
this.updateAverageSeriesLastNode=function(source,destination,averageSizeNum,bBreakable,bIgnoreNoTrade){if(source==null||destination==null||averageSizeNum<1||source.length<averageSizeNum-1)
return;var fSum=0;var count=averageSizeNum;for(var i=source.length-1;i>=0&&count!=0;i--){var sp=source[i];if(bIgnoreNoTrade&&((sp==null||sp.isInvalid)||isNaN(sp.value)||sp.value==0)){continue;}
fSum+=sp.value;count--;}
if(count!=0){return;}
var destLastNode=getLastOrDefault(destination);var srcLastNode=getLastOrDefault(source);if(srcLastNode.argument!=destLastNode.argument){destination.push(new mscdp_seriesPoint(srcLastNode.argument,fSum/averageSizeNum));}
else{destLastNode.value=fSum/averageSizeNum;}}
this.createExponentialAverageSeries=function(source,destination,averageSizeNum,bBreakable,bIgnoreNoTrade){if(source==null||averageSizeNum<1||source.Count<averageSizeNum-1){return;}
var validDataSource=bIgnoreNoTrade?filterValidDatasource(source):source;if(validDataSource.length<averageSizeNum){return;}
var ema=0;for(var i=averageSizeNum-1;i<validDataSource.length;i++){var validSeriesPoint=validDataSource[i];if(i==averageSizeNum-1){ema=getAverageValue(validDataSource,averageSizeNum);}
else{ema=(validSeriesPoint.value-ema)*(2/(averageSizeNum+1))+ema;}
var sp=getFirstOrDefaultByArgument(destination,validSeriesPoint.argument);if(sp!=null){sp.value=ema;}
else{var objSeries=new mscdp_seriesPoint(validSeriesPoint.argument,ema);destination.push(objSeries);}}}
this.updateExponentialAverageSeriesLastNode=function(source,destination,averageSizeNum,bBreakable,bIgnoreNoTrade){if(source==null||destination==null||averageSizeNum<1||source.length<averageSizeNum-1){return;}
var validDataSource=bIgnoreNoTrade?filterValidDatasource(source):source;if(validDataSource.length<averageSizeNum){return;}
var destLastNode=lastOrDefault(destination);var srcLastNode=lastOrDefault(source);if(srcLastNode.argument==destLastNode.argument){if(destination.length==1){destLastNode.value=getAverageValue(validDataSource,averageSizeNum);}
else{var ema=destination[destination.length-2].value;destLastNode.value=(srcLastNode.value-ema)*(2/(averageSizeNum+1))+ema;}}
else{var ema=(srcLastNode.value-destLastNode.value)*(2/(averageSizeNum+1))+destLastNode.value;destination.push(mscdp_seriesPoint(srcLastNode.argument,ema));}}}
var mscdpds_technicalCalculations=new function()
{this.min=function(values,st,range)
{var i;var min=msccut_utilsDouble.maxValue;for(i=st;i>st-range;i--)
{if(values[i].value>0&&min>values[i].value)
{min=values[i].value;}}
return min=min==msccut_utilsDouble.maxValue?0:min;}
this.max=function(values,st,range)
{var i;var max=values[st].value;for(i=st;i>st-range;i--)
{if(values[i].value>0&&max<values[i].value)
{max=values[i].value;}}
return max;}
this.stochastics=function(priceSeries,range,rLine,kLine)
{var closeCount=priceSeries.length;var closeValues=[];for(var row=0;row<closeCount;row++)
{var s=priceSeries[row];var objItem=new mscdp_seriesPoint(s.argument,s.value);closeValues.push({date:s.argument,value:s.value});}
var rValues=[];for(var i=0;i<closeCount;i++)
{rValues.push(0);}
for(var i=closeCount-1;i>=range&&closeValues[i].value>0;i--)
{var nc=this.min(closeValues,i,range);var a=this.max(closeValues,i,range)-nc;rValues[i]=(a>0?100*(closeValues[i].value-nc)/a:0);}
for(var i=range-1;i>=0;i--)
{var nc=this.min(closeValues,i,i);var a=this.max(closeValues,i,i)-nc;rValues[i]=(a>0?100*(closeValues[i].value-nc)/a:0);}
var returnValues=[];returnValues.push({kLine:rValues[0],date:closeValues[0].date,rLine:rValues[0]});for(var i=1;i<closeCount;i++)
{var kVal=returnValues[i-1].kLine*2/3+rValues[i]/3;var rVal=returnValues[i-1].rLine*2/3+kVal/3;returnValues.push({kLine:kVal,date:closeValues[i].date,rLine:rVal});}
for(var i=0;i<returnValues.length;i++)
{var pair=returnValues[i];rLine.push(new mscdp_seriesPoint(pair.date,pair.rLine));kLine.push(new mscdp_seriesPoint(pair.date,pair.kLine));}}}
function Axis(clientRect,geo){this.refresh(clientRect,geo);}
Axis.prototype.refresh=function(clientRect,geo){var padding=3;this.physicalStart=geo.y+padding;this.physicalEnd=geo.height+geo.y-padding;this.logicalStart=clientRect.minValue;this.logicalEnd=clientRect.maxValue;this.isLogarithmic=false;};Axis.prototype.transform=function(value){if(this.isLogarithmic){value=MathCommon.linearizeLog10(value);var logicalStart=MathCommon.linearizeLog10(this.logicalStart);var logicalEnd=MathCommon.linearizeLog10(this.logicalEnd);}
else{var logicalStart=this.logicalStart;var logicalEnd=this.logicalEnd;}
var valToPixRatio=(value-logicalStart)/(logicalEnd-logicalStart);var retVal=this.physicalStart+valToPixRatio*(this.physicalEnd-this.physicalStart);return retVal;};Axis.prototype.reverseTransform=function(coordinate){var pixToValRatio=(coordinate-this.physicalStart)/(this.physicalEnd-this.physicalStart);var retVal=this.logicalStart+pixToValRatio*(this.logicalEnd-this.logicalStart);return retVal};function CoordinateSystem(xAxis,yAxis){this.xAxis=xAxis;this.yAxis=yAxis;}
CoordinateSystem.prototype.transformValue=function(value){if(this.yAxis)
return this.yAxis.transform(value);return NaN;};CoordinateSystem.prototype.reverseTransformY=function(y){if(this.yAxis)
return this.yAxis.reverseTransform(y);return NaN;};var mscdp_chartInstrumentType={unspecified:0,stock:1,currency:2,futures:3,indexAndMI:4,industryGroup:5,mutualFund:6,options:7,indexMI:8,indexMA:9,mutualFundIndex:10};var mscdp_chartFrequency={intraday:0,daily:1,weekly:2,monthly:3,annual:5,semiAnnual:6,marketSchool:7,etfMarketStrategy:8,quarterly:9,hour:10};var mscdp_dateStyleType={tradingDate:"0",holiday:"1",marketCloseDate:"2",noTrade:"3"};function mscdp_dataProvider(url,datasource,onDatasourceChanged){var xmlHttpRequest=false;var abortRequest=function(){if(xmlHttpRequest){xmlHttpRequest.abort();}};var getIndexSP=function(v){var isValid=v.date!=null&&v.indexClose!=null&&v.dateIndicator==mscdp_dateStyleType.tradingDate;if(isValid){return new mscdp_seriesPoint(v.date,v.indexClose);}
return mscdp_invalidSeriesPoints.invalidSeriesPoint;};var getVolumeSP=function(v,vPrev){var isValid=v.date!=null&&v.volume!=null&&v.volume>=0&&v.close!=null&&vPrev!=null&&v.dateIndicator==mscdp_dateStyleType.tradingDate;if(isValid){return new mscdp_volumeSeriesPoint(v.date,v.volume,v.close>=vPrev);}
return mscdp_invalidSeriesPoints.invalidVolumeSeriesPoint;};var getPriceSP=function(v){var isValid=v.date!=null&&v.close!=null&&v.high!=null&&v.low!=null&&v.dateIndicator==mscdp_dateStyleType.tradingDate;if(isValid){return new mscdp_hLOSeriesPoint(v.date,v.high,v.low,v.close,v.close)}
return mscdp_invalidSeriesPoints.invalidHLOSeriesPoint;};var getNoVolumeSeriesCount=function(series){var res=0;for(var i=0;i<series.length;i++){if(!series[i].isNoVolume){res++;}}
return res;};var processPricePeakValleyValues=function(series){if(series==null){return;}
var range=10;var count=getNoVolumeSeriesCount(series);if(count<range){return;}
for(var eachNode=series.length-range;eachNode>range;eachNode--){var hlsp=series[eachNode];var peak=true;for(var i=1;i<range;i++){if(hlsp.getHighValue()<=series[eachNode+i].getHighValue()||hlsp.getHighValue()<series[eachNode-i].getHighValue()||hlsp.isNoVolume){peak=false;break;}}
if(peak){hlsp.isPeakVolume=true;}
var valley=true;for(var i=1;i<range;i++){if(hlsp.getLowValue()>=series[eachNode+i].getLowValue()||hlsp.getLowValue()>series[eachNode-i].getLowValue()||hlsp.isNoVolume){valley=false;break;}}
if(valley){hlsp.isValleyVolume=true;}}};var processVolumePeakValues=function(series){var range=13;if(series==null||series.length<range){return;}
for(var eachNode=range;eachNode<series.length-range;eachNode++){var peak=true;for(var i=1;i<range;i++){if(series[eachNode].value<=series[eachNode+i].value||series[eachNode].value<series[eachNode-i].value){peak=false;break;}}
if(peak){series[eachNode].isPeakVolume=true;}}};var iBDIndexTickers=["0MUTI","0IBD1","0IBD8","0NA6M","0IB2I"];var getIsIBDIndexTicker=function(ticker){for(var i=0;i<iBDIndexTickers.length;i++){if(ticker.toString().toUpperCase()==iBDIndexTickers[i]){return true;}}
return false;};this.loadChartData=function(symbol,from,to,frequency,frequencyUnit,instrumentType){datasource.isIdle=true;datasource.error=null;var serviceUrl=url+'/GetData';var req={'req':{'Symbol':symbol,'Type':frequency,'StartDate':from,'EndDate':to,'EnableBats':true}};xmlHttpRequest=JSON2.svcGetData(serviceUrl,JSON.stringify(req),function(data){datetimePageLoad={serverDateTime:new Date(data.asOf),clientDateTime:new Date(),timeOffset:0};datetimePageLoad.timeOffset=datetimePageLoad.serverDateTime.getTime()-datetimePageLoad.clientDateTime.getTime();if(data==null||data.errorMessage!=''||data.series==null||data.series.length==0){var errorObj={};errorObj.errMsg='Invalid Data';if(data.errorMessage.toLowerCase().indexOf('invalid symbol')>-1){errorObj.errMsg='Invalid Symbol';}
errorObj.details=data.errorMessage;errorObj.source={url:serviceUrl,data:data};datasource.error=errorObj;datasource.isIdle=false;onDatasourceChanged();return;}
datasource.frequency=frequency;datasource.companyInfo=data.companyInfo;datasource.companyInfo.ePSRating=data.ePSRating;datasource.companyInfo.isIBDIndexTicker=getIsIBDIndexTicker(symbol);datasource.isStock=data.companyInfo.type.toString().toLowerCase()=="stock";datasource.summary=data.summary;datasource.fiscalMonthEnd=data.fiscalMonthEnd;datasource.source=data.source;datasource.priceChartDatasource.graphDataRetrievedAsOf=data.asOf;datasource.priceChartDatasource.rSRating=data.rSRating;datasource.holidays=data.holidays;var seriesCount=data.series.length;var reverseInserting=data.series[0].date>data.series[seriesCount-1].date;for(var index=reverseInserting?seriesCount-1:0;reverseInserting?index>=0:index<=seriesCount-1;index+=reverseInserting?-1:1){var v=data.series[index];var vPrevClose=index==(reverseInserting?seriesCount-1:0)?0:data.series[index+(reverseInserting?1:-1)].close;if(v.dateIndicator==mscdp_dateStyleType.holiday){var sp=new mscdp_seriesPoint(v.date);sp.state="Holiday";datasource.priceChartDatasource.holidaySeries.push(sp);}
else if(v.dateIndicator==mscdp_dateStyleType.marketCloseDate){var sp=new mscdp_seriesPoint(v.date);sp.state="Market Closed";datasource.priceChartDatasource.holidaySeries.push(sp);}
else if(v.dateIndicator==mscdp_dateStyleType.noTrade){var sp=new mscdp_seriesPoint(v.date);sp.state="No Trade";datasource.priceChartDatasource.holidaySeries.push(sp);}
var volumeSP=getVolumeSP(v,vPrevClose);if(!volumeSP.isInvalid){if(frequency==mscdp_chartFrequency.weekly){if((reverseInserting&&index>0)||(!reverseInserting&&index<seriesCount-1)){volumeSP.tag=volumeSP.argument;var shiftFromFriday=5-volumeSP.argument.getDay();volumeSP.argument.setDate(volumeSP.argument.getDate()+shiftFromFriday);}}
if(volumeSP.value!=0)
datasource.priceChartDatasource.volumeSeries.push(volumeSP);}
var priceSP=getPriceSP(v);if(!priceSP.isInvalid){if(instrumentType!=mscdp_chartInstrumentType.stock){datasource.priceChartDatasource.priceSeries.push(priceSP);}
else{if(v.volume!=null){if(index==(reverseInserting?0:seriesCount-1)){var dtNowEst=data.asOf;if(!msccut_utilsDate.comapreDatePart(dtNowEst,priceSP.argument)||dtNowEst.getHours()>16||v.volume>0){datasource.priceChartDatasource.priceSeries.push(priceSP);}}
else{datasource.priceChartDatasource.priceSeries.push(priceSP);}}}}
var indexSP=getIndexSP(v);if(!indexSP.isInvalid){datasource.priceChartDatasource.indexSeries.push(indexSP);}}
processPricePeakValleyValues(datasource.priceChartDatasource.priceSeries);processVolumePeakValues(datasource.priceChartDatasource.volumeSeries);processVolumePeakValues(datasource.priceChartDatasource.dailyVolumeSeries);if(datasource.priceChartDatasource.priceSeries.Count==0){datasource.priceChartDatasource.priceSeries=null;}
if(datasource.priceChartDatasource.volumeSeries.Count==0){datasource.priceChartDatasource.volumeSeries=null;}
if(datasource.priceChartDatasource.indexSeries.Count==0){datasource.priceChartDatasource.indexSeries=null;}
datasource.isIdle=false;onDatasourceChanged();});};}
function mscdp_priceChartDatasource()
{this.priceSeries=[];this.volumeSeries=[];this.dailyVolumeSeries=[];this.priceSeriesAll=[];this.volumeSeriesAll=[];this.indexSeries=[];this.holidaySeries=[];this.rSRating=null;this.graphDataRetrievedAsOf=null;var _priceAverageData=[];var _priceExponentialAverageData=[];var _volumeAverageData=[];var _volumeAverageDataNoTradeIncluded=[];var _dailyVolumeAverageData=[];var _dailyVolumeAverageDataNoTradeIncluded=[];var actualSteps=[];var dateArray=[];var actualStepsVol=[];var dateArrayVol=[];this.clear=function(){this.priceSeries=null;this.priceSeries=[];this.volumeSeries=null;this.volumeSeries=[];this.dailyVolumeSeries=null;this.dailyVolumeSeries=[];this.priceSeriesAll=null;this.priceSeriesAll=[];this.volumeSeriesAll=null;this.volumeSeriesAll=[];this.indexSeries=null;this.indexSeries=[];this.holidaySeries=null;this.holidaySeries=[];_priceAverageData=null;_priceAverageData=[];_priceExponentialAverageData=null;_priceExponentialAverageData=[];_volumeAverageData=null;_volumeAverageData=[];_volumeAverageDataNoTradeIncluded=null;_volumeAverageDataNoTradeIncluded=[];_dailyVolumeAverageData=null;_dailyVolumeAverageData=[];_dailyVolumeAverageDataNoTradeIncluded=null;_dailyVolumeAverageDataNoTradeIncluded=[];actualSteps=[];dateArray=[];this.rSRating=null;this.graphDataRetrievedAsOf=null;};this.getMaxMinPrices=function(isSmallCount){var max=null,min=null;var series=this.priceSeries;if(isSmallCount){this.cutCount=0;}else{series=this.priceSeries.slice(this.cutCount);}
if(this.priceSeries[this.priceSeries.length-1].value==0){var lastDay=this.priceSeries.indexOf(this.priceSeries[this.priceSeries.length-1]);series.splice(lastDay-this.cutCount,1);};if(series.length>0){max=series[0].getHighValue();min=series[0].getLowValue();for(var i=1;i<series.length;i++){var high=series[i].getHighValue();var low=series[i].getLowValue();if(max<high)max=high;if(min>low)min=low;}}
return{max:max,min:min};};this.getActualVolumes=function(freq){function removeDuplicateElement(arrayName){var newArray=new Array();label:for(var i=0;i<arrayName.length;i++){for(var j=0;j<newArray.length;j++){if(newArray[j].argument.valueOf()==arrayName[i].argument.valueOf())
continue label;}
newArray[newArray.length]=arrayName[i];}
return newArray;}
var series=this.volumeSeries.slice(this.cutCount).sort(function(a,b){return a.argument.valueOf()-b.argument.valueOf();});if(this.volumeSeries.length>0){if(this.volumeSeries[this.volumeSeries.length-1].value==0){var lastDay=this.volumeSeries.indexOf(this.volumeSeries[this.volumeSeries.length-1]);series.splice(lastDay-this.cutCount,1);};}else{return 0;}
if(freq==2){for(var i=0;i<series.length;i++){dateArrayVol.push(series[i].argument);}
var s=removeDuplicateElement(series);return{steps:s,dateArray:dateArrayVol};}
if(actualStepsVol.length==0||dateArrayVol.length==0){var start=new Date(series[0].argument.valueOf());var end=new Date(series[series.length-1].argument.valueOf());while(start<=end){dateArrayVol.push(start);var newDate=new Date(start.valueOf());newDate.setDate(start.getDate()+1);start=new Date(newDate);}
var dateIndex=0;var series=removeDuplicateElement(series);for(var i=0;i<dateArrayVol.length;i++){var sp=series[dateIndex];if(dateArrayVol[i].valueOf()!=sp.argument.valueOf()){if(dateArrayVol[i].getDay()!=6&&dateArrayVol[i].getDay()!=0){actualStepsVol.push(null);}
continue;}
actualStepsVol.push(sp);if(dateIndex!=series.length-1)
dateIndex++;}}
return{steps:actualStepsVol,dateArray:dateArrayVol};};this.getActualPrices=function(freq){function removeDuplicateElement(arrayName){var newArray=new Array();label:for(var i=0;i<arrayName.length;i++){for(var j=0;j<newArray.length;j++){if(newArray[j].argument.valueOf()==arrayName[i].argument.valueOf())
continue label;}
newArray[newArray.length]=arrayName[i];}
return newArray;}
var series=this.priceSeries.slice(this.cutCount);if(this.volumeSeries.length>0)
if(this.volumeSeries[this.volumeSeries.length-1].value==0&&this.priceSeries[this.priceSeries.length-1]){var lastDay=this.priceSeries.indexOf(this.priceSeries[this.priceSeries.length-1]);series.splice(lastDay-this.cutCount,1);};if(freq==2){for(var i=0;i<series.length;i++){dateArray.push(series[i].argument);}
var s=removeDuplicateElement(series);return{steps:s,dateArray:dateArray};}
if(actualSteps.length==0||dateArray.length==0){var start=new Date(series[0].argument.valueOf());var end=new Date(series[series.length-1].argument.valueOf());while(start<=end){dateArray.push(start);var newDate=new Date(start.valueOf());newDate.setDate(start.getDate()+1);start=new Date(newDate);}
var dateIndex=0;var series=removeDuplicateElement(series);for(var i=0;i<dateArray.length;i++){var sp=series[dateIndex];if(dateArray[i].valueOf()!=sp.argument.valueOf()){if(dateArray[i].getDay()!=6&&dateArray[i].getDay()!=0){actualSteps.push(null);}
continue;}
actualSteps.push(sp);if(dateIndex!=series.length-1)
dateIndex++;}}
return{steps:actualSteps,dateArray:dateArray};};this.getPriceAverageDatasource=function(range){if(this.priceSeries==null||_priceAverageData==null||range<0)
return null;var dataFromDic=mscdpds_dictionaryHelper.getDataByKey(_priceAverageData,range);if(dataFromDic!=null){return dataFromDic;}
var newSeries=[];mscdpds_datasourceHelper.createAverageSeries(this.priceSeries,newSeries,range,false,true);mscdpds_dictionaryHelper.addItem(_priceAverageData,range,newSeries);return newSeries;};this.getPriceExponentialAverageDatasource=function(range){if(this.priceSeries==null||_priceExponentialAverageData==null||range<0){return null;}
var dataFromDic=mscdpds_dictionaryHelper.getDataByKey(_priceExponentialAverageData,range);if(dataFromDic!=null){return dataFromDic;}
var newSeries=[];mscdpds_datasourceHelper.createExponentialAverageSeries(this.priceSeries,newSeries,range,false,false);mscdpds_dictionaryHelper.addItem(_priceExponentialAverageData,range,newSeries);return newSeries;};this.getVolumeAverageDatasource=function(range,bIgnoreNoTrade,bIgnoreFirstTick){if(this.volumeSeries==null||range<0){return null;}
var collection=bIgnoreNoTrade?_volumeAverageData:_volumeAverageDataNoTradeIncluded;var dataFromDic=mscdpds_dictionaryHelper.getDataByKey(collection,range);if(dataFromDic!=null){return dataFromDic;}
var newSeries=[];mscdpds_datasourceHelper.createAverageSeries(this.volumeSeries,newSeries,range,false,bIgnoreNoTrade,bIgnoreFirstTick);mscdpds_dictionaryHelper.addItem(collection,range,newSeries);return newSeries;};this.getDailyVolumeAverageDatasource=function(range,bIgnoreNoTrade){if(this.dailyVolumeSeries==null||range<0){return null;}
var collection=bIgnoreNoTrade?_dailyVolumeAverageData:_dailyVolumeAverageDataNoTradeIncluded;var dataFromDic=mscdpds_dictionaryHelper.getDataByKey(collection,range);if(dataFromDic!=null){return dataFromDic;}
var newSeries=[];mscdpds_datasourceHelper.createAverageSeries(this.dailyVolumeSeries,newSeries,range,false,bIgnoreNoTrade);mscdpds_dictionaryHelper.addItem(collection,range,newSeries);return newSeries;};this.getStochasticSeries=function(range){var stochasticViews=new Object();stochasticViews.rLine=[];stochasticViews.kLine=[];if(this.priceSeries!=null){mscdpds_technicalCalculations.stochastics(this.priceSeries,Math.min(this.priceSeries.length,range),stochasticViews.rLine,stochasticViews.kLine);}
return stochasticViews;};this.updateDatasource=function(){this.updatePriceAverageDatasource();this.updateVolumeAverageDatasource();};this.updateAverageDatasource=function(){for(var i=0;i<_priceAverageData.length;i++){mscdpds_datasourceHelper.updateAverageSeriesLastNode(this.priceSeries,_priceAverageData[i].value,_priceAverageData[i].key,false,true);}
for(var i=0;i<_priceExponentialAverageData.length;i++){mscdpds_datasourceHelper.updateExponentialAverageSeriesLastNode(this.priceSeries,_priceExponentialAverageData[i].value,_priceExponentialAverageData[i].key,false,true);}
for(var i=0;i<_volumeAverageData.length;i++){mscdpds_datasourceHelper.updateAverageSeriesLastNode(this.volumeSeries,_volumeAverageData[i].value,_volumeAverageData[i].key,false,true);}
for(var i=0;i<_volumeAverageDataNoTradeIncluded.length;i++){mscdpds_datasourceHelper.updateAverageSeriesLastNode(this.volumeSeries,_volumeAverageDataNoTradeIncluded[i].value,_volumeAverageDataNoTradeIncluded[i].key,false,false);}};this.updatePriceAverageDatasource=function(){for(var i=0;i<_priceAverageData.length;i++){_priceAverageData[i].value=null;_priceAverageData[i].value=[];mscdpds_datasourceHelper.createAverageSeries(this.priceSeries,_priceAverageData[i].value,_priceAverageData[i].key,false,true);}
for(var i=0;i<_priceExponentialAverageData.length;i++){_priceExponentialAverageData[i].value=null;_priceExponentialAverageData[i].value=[];mscdpds_datasourceHelper.createExponentialAverageSeries(this.priceSeries,_priceExponentialAverageData[i].value,_priceExponentialAverageData[i].key,false,true);}};this.updateVolumeAverageDatasource=function(){_volumeAverageData=[];for(var i=0;i<_volumeAverageDataNoTradeIncluded.length;i++){_volumeAverageDataNoTradeIncluded[i].value=null;_volumeAverageDataNoTradeIncluded[i].value=[];mscdpds_datasourceHelper.createAverageSeries(this.volumeSeries,_volumeAverageDataNoTradeIncluded[i].value,_volumeAverageDataNoTradeIncluded[i].key,false,false);}};this.isPriceSeriesExist=function(){return this.priceSeries!=null&&this.priceSeries.length>0;}
this.isVolumeSeriesExist=function(){return this.volumeSeries!=null&&this.volumeSeries.length>0;}
this.isIndexSeriesExist=function(){return this.indexSeries!=null&&this.indexSeries.length>0;}
this.isHolidaySeriesExist=function(){return this.holidaySeries!=null&&this.holidaySeries.length>0;}}
function mscdp_basicChartDatasource()
{this.isIdle=false;this.error=null;this.errorData=null;this.isLoaded=function(){return this.priceChartDatasource.graphDataRetrievedAsOf!=null;};this.priceChartDatasource=new mscdp_priceChartDatasource();this.frequency=null;this.isRealTime=null;this.companyInfo=null;this.summary=null;this.fiscalMonthEnd=null;this.displayIndicator=null;this.updateTime=null;this.source=null;this.fundamentalBlock=null;this.quarterlyBlock=null;this.holidays=null;this.clear=function(){this.frequency=null;this.isRealTime=false;this.isIdle=false;this.error=null;this.errorData=null;this.companyInfo=null;this.summary=null;this.source=null;this.fiscalMonthEnd=null;this.displayIndicator=null;this.updateTime=null;this.fundamentalBlock=null;this.quarterlyBlock=null;this.holidays=null;this.priceChartDatasource.clear();};var getFirstSeriesByArgument=function(series,argument){for(var i=0;i<series.length;i++){var sp=series[i];if(sp.argument==argument){return sp;}}
return null;};this.getMaxMin=function(seriesArray){var max=null,min=null;if(seriesArray.length>0){if(this.priceChartDatasource.volumeSeries[this.priceChartDatasource.volumeSeries.length-1])
if(this.priceChartDatasource.volumeSeries[this.priceChartDatasource.volumeSeries.length-1].value==0){var lastDay=seriesArray.indexOf(seriesArray[seriesArray.length-1]);seriesArray.splice(lastDay,1);};max=seriesArray[0].getMaxValue();min=seriesArray[0].getMinValue();for(var i=1;i<seriesArray.length;i++){var high=seriesArray[i].getMaxValue();var low=seriesArray[i].getMinValue();if(max<high)max=high;if(min>low)min=low;}}
return{max:max,min:min};};this.createDatasourceRS=function(){var multiplier=0.75;var priceSeries=this.priceChartDatasource.priceSeries.slice(this.cutCount);var benchmarkSeries=this.priceChartDatasource.indexSeries.slice(this.cutCount);if(priceSeries==null||benchmarkSeries==null){return null;}
var rsSeries=[];var spFactor=multiplier*benchmarkSeries[benchmarkSeries.length-1].value;for(var i=0;i<benchmarkSeries.length;i++){var sp=benchmarkSeries[i];var tempSP=sp;var priceSP=getFirstSeriesByArgument(priceSeries,tempSP.argument);if(priceSP!=null){var rsp=new mscdp_seriesPoint();rsp.argument=sp.argument;rsp.price=priceSP.value;rsp.benchmark=sp.value;rsp.value=priceSP.value*spFactor/sp.value;rsSeries.push(rsp);}}
return rsSeries.length==0?null:rsSeries;};this.getCompanySummaryInfo=function(){var res={volume:0,volumeChange:0,volumeChangePercent:0,volumeChangeVsPriorDay:0,volumeChangePercentVsPriorDay:0,price:0,priceChange:0,priceChangePercent:0};if(this.frequency==mscdp_chartFrequency.intraday){res.volume=this.companyInfo.volume;res.volumeChange=(res.volume*this.companyInfo.dayRate)-this.companyInfo.avgVolume;res.volumeChangePercent=(res.volumeChange/this.companyInfo.avgVolume)*100;res.price=this.companyInfo.price;res.priceChange=this.companyInfo.priceChange;res.priceChangePercent=(res.priceChange/(res.price-res.priceChange))*100;}
else{var chng=msccm_chartModelController.getChangePercentages(this.priceChartDatasource.priceSeries.length-1,this.priceChartDatasource.volumeSeries.length-1,this);if(this.priceChartDatasource.volumeSeries.length>0){res.volume=this.priceChartDatasource.volumeSeries[this.priceChartDatasource.volumeSeries.length-1].value;res.volumeChange=chng.volumeChange;res.volumeChangePercent=chng.volumeChangePercent;}
if(this.priceChartDatasource.priceSeries.length>0){res.price=this.priceChartDatasource.priceSeries[this.priceChartDatasource.priceSeries.length-1].value;}
else{res.price=this.companyInfo.price;}
res.priceChange=chng.closeChange;res.priceChangePercent=chng.closeChangePercent;}
if(this.companyInfo!=null){res.volumeChangeVsPriorDay=this.companyInfo.volume-this.companyInfo.volumeBase;res.volumeChangePercentVsPriorDay=this.companyInfo.volumeBase==0?0:res.volumeChangeVsPriorDay*100/this.companyInfo.volumeBase;}
return res;};}
var JSON2=new function()
{this.options={error:false,noCache:true};this.lastRequest={url:"",data:""};var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var escapeable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'};var rep;var dateRx=/\/Date\((-?[0-9]+)((?:\+|\-)[0-9]+)?\)\//g;var quote=function(string)
{escapeable.lastIndex=0;return escapeable.test(string)?'"'+string.replace(escapeable,function(a)
{var c=meta[a];if(typeof c==='string')
{return c;}
return'\\u'+('0000'+
(+(a.charCodeAt(0))).toString(16)).slice(-4);})+'"':'"'+string+'"';}
var str=function(key,holder)
{var i,k,v,length,mind=gap,partial,value=holder[key];if(typeof rep==='function')
{value=rep.call(holder,key,value);}
switch(typeof value)
{case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value)
{return'null';}
gap+=indent;partial=[];if(typeof value.length==='number'&&!(value.propertyIsEnumerable('length')))
{length=value.length;for(i=0;i<length;i+=1)
{partial[i]=str(i,value)||'null';}
v=partial.length===0?'[]':gap?'[\n'+gap+
partial.join(',\n'+gap)+'\n'+
mind+']':'['+partial.join(',')+']';gap=mind;return v;}
if(rep&&typeof rep==='object')
{length=rep.length;for(i=0;i<length;i+=1)
{k=rep[i];if(typeof k==='string')
{v=str(k,value,rep);if(v)
{partial.push(quote(k)+(gap?': ':':')+v);}}}}else
{for(k in value)
{if(Object.hasOwnProperty.call(value,k))
{v=str(k,value,rep);if(v)
{partial.push(quote(k)+(gap?': ':':')+v);}}}}
v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+
mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}
var dTOffest=null;var parseJsonDate=function(jsonDate)
{if(dTOffest==null)
{dTOffest=new Date().getTimezoneOffset()*60000;}
var parts=/\/Date\((-?\d+)([+-]\d{2})?(\d{2})?.*/.exec(jsonDate);if(parts[2]==undefined)
{parts[2]=0;}
if(parts[3]==undefined)
{parts[3]=0;}
var retVal=new Date(+parts[1]+parts[2]*3600000+parts[3]*60000);retVal.setTime(retVal.getTime()+retVal.getTimezoneOffset()*60000);return retVal;};var dT=function(val)
{for(p in val)
{if(typeof val[p]==="string")
{if(val[p].indexOf("/Date(")==0)
{val[p]=parseJsonDate(val[p]);}}
else if(typeof val[p]==="object"||typeof val[p]=="array")
{dT(val[p]);}}}
var stringify=function(value,replacer,space)
{var i;gap='';indent='';if(typeof space==='number')
{for(i=0;i<space;i+=1)
{indent+=' ';}}
else if(typeof space==='string')
{indent=space;}
rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number'))
{throw new Error('JSON.stringify');}
return str('',{'':value});}
var parseString2Json=function(data){var stringArray=data.split(';');var series=[];if(stringArray.length>3){for(var i=0;i<stringArray.length-1;i++){var serie=stringArray[i].split(',');var item=new Object();item.date=new Date(serie[0]);item.high=parseFloat(serie[1]);item.low=parseFloat(serie[2]);item.close=parseFloat(serie[3]);item.indexClose=parseFloat(serie[4]);item.dateIndicator=serie[5];item.volume=parseInt(serie[6]);series.push(item);}
var jsonObj=JSON.parse(stringArray[stringArray.length-1]);jsonObj.series=series;jsonObj.asOf=new Date(jsonObj.asOf);jsonObj.startDate=new Date(jsonObj.startDate);jsonObj.endDate=new Date(jsonObj.endDate);jsonObj.summary.newIssue=new Date(jsonObj.summary.newIssue);for(i=0;i<jsonObj.holidays.length;i++){jsonObj.holidays[i].date=new Date(jsonObj.holidays[i].date);}
return jsonObj;}
else return{series:null,errorMessage:'no data returned'};}
var parse=function(text,reviver)
{var j;function walk(holder,key)
{var k,v,value=holder[key];if(value&&typeof value==='object')
{for(k in value)
{if(Object.hasOwnProperty.call(value,k))
{v=walk(value,k);if(v!==undefined)
{value[k]=v;}else
{delete value[k];}}}}
return reviver.call(holder,key,value);}
cx.lastIndex=0;if(cx.test(text))
{text=text.replace(cx,function(a)
{return'\\u'+('0000'+
(+(a.charCodeAt(0))).toString(16)).slice(-4);});}
if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,'')))
{j=eval('('+text+')');dT(j);return typeof reviver==='function'?walk({'':j},''):j;}
throw new SyntaxError('JSON.parse');}
var getXmlHttpRequest=function()
{if(typeof XMLHttpRequest!="undefined")
{return new XMLHttpRequest();}
else if(typeof ActiveXObject!="undefined")
{try
{return new ActiveXObject('Msxml2.XMLHTTP');}
catch(err)
{try{return new ActiveXObject('Microsoft.XMLHTTP');}catch(e){}}}}
this.svcGetData=function(url,data,success,error){var xmlHttpRequest=getXmlHttpRequest();this.lastRequest.url=url;this.lastRequest.data=data;xmlHttpRequest.open('POST',url,true,null,null);xmlHttpRequest.onreadystatechange=function(){if(xmlHttpRequest.readyState==4){var r=xmlHttpRequest.responseText;var e=null;if(r.constructor==String){if(r!=''){try{r=parse(xmlHttpRequest.responseText);r=r.GetDataResult;if(typeof r=="object"&&r.Message!==undefined&&r.StackTrace!==undefined&&r.ExceptionType!==undefined){e=r;}}
catch(err){e=err;}}
else{r={};}}
if(e==null&&xmlHttpRequest.status==200){success(r||e,xmlHttpRequest.status,xmlHttpRequest.statusText,new Object());}
else{if(error){error(e);}
else if(JSON2.options.error){JSON2.options.error(e);}}}};if(JSON2.options.noCache){xmlHttpRequest.setRequestHeader('If-Modified-Since','Thu, 1 Jan 1970 00:00:00 GMT');xmlHttpRequest.setRequestHeader('Cache-Control','no-cache');xmlHttpRequest.setRequestHeader('Content-Type','application/json;charset=utf-8');}
xmlHttpRequest.send(data);return xmlHttpRequest;}
var parseString2Json=function(data){var stringArray=data.split(';');var series=[];if(stringArray.length>3){for(var i=0;i<stringArray.length-1;i++){var serie=stringArray[i].split(',');var item=new Object();item.date=new Date(serie[0]);item.high=parseFloat(serie[1]);item.low=parseFloat(serie[2]);item.close=parseFloat(serie[3]);item.indexClose=parseFloat(serie[4]);item.dateIndicator=serie[5];item.volume=parseInt(serie[6]);series.push(item);}
var jsonObj=JSON.parse(stringArray[stringArray.length-1]);jsonObj.series=series;jsonObj.asOf=new Date(jsonObj.asOf);jsonObj.startDate=new Date(jsonObj.startDate);jsonObj.endDate=new Date(jsonObj.endDate);jsonObj.summary.newIssue=new Date(jsonObj.summary.newIssue);for(i=0;i<jsonObj.holidays.length;i++){jsonObj.holidays[i].date=new Date(jsonObj.holidays[i].date);}
return jsonObj;}
else return{series:null,errorMessage:'no data returned'};}}
function mscdp_seriesPoint(argument,value,tag)
{this.state=null;this.tag=tag;this.argument=argument;this.value=value;this.isInvalid=false;this.getMinValue=function()
{return this.value;}
this.getMaxValue=function()
{return this.value;}}
function mscdp_volumeSeriesPoint(argument,value,isUpPrice,tag)
{this.state=null;this.tag=tag;this.argument=argument;this.value=value;this.isInvalid=false;this.isUpPrice=isUpPrice;this.isPeakVolume=false;this.getMinValue=function()
{return this.value;}
this.getMaxValue=function()
{return this.value;}}
function mscdp_hLOSeriesPoint(argument,high,low,open,close,tag)
{var highValue=high;var lowValue=low;this.state=null;this.tag=tag;this.argument=argument;this.value=close;this.isInvalid=false;this.openValue=open;this.isPeakVolume=false;this.isValleyVolume=false;this.isNoVolume=false;this.isUpPrice=false;this.updateValue=function(BATSdata){this.value=BATSdata.Last;if(highValue<BATSdata.High)highValue=BATSdata.High;if(lowValue>BATSdata.Low)lowValue=BATSdata.Low;}
this.getMinValue=function()
{return lowValue;}
this.getMaxValue=function()
{return highValue;}
this.getHighValue=function()
{this.normalizeRange();return highValue;}
this.getLowValue=function()
{this.normalizeRange();return lowValue;}
this.compareByValue=function(other)
{return highValue-other.value;}
this.normalizeRange=function()
{if(lowValue-highValue>0)
{var temp=lowValue;lowValue=highValue;highValue=temp;}}
this.extractHighVal=function()
{return new mscdp_seriesPoint(this.argument,this.getHighValue(),this.tag);}
this.extractLowVal=function()
{return new mscdp_seriesPoint(this.argument,this.getLowValue(),this.tag);}
this.extractOpenVal=function()
{return new mscdp_seriesPoint(this.argument,this.openValue);}
this.extractCloseVal=function()
{return new mscdp_seriesPoint(this.argument,this.value);}}
var mscdp_invalidSeriesPoints=new function()
{this.invalidSeriesPoint=new mscdp_seriesPoint();this.invalidSeriesPoint.isInvalid=true;this.invalidVolumeSeriesPoint=new mscdp_volumeSeriesPoint();this.invalidVolumeSeriesPoint.isInvalid=true;this.invalidHLOSeriesPoint=new mscdp_hLOSeriesPoint();this.invalidHLOSeriesPoint.isInvalid=true;}
function ViewStockPrice(graphicContext,coordinateSystem,datasource){this.clientRect=null;this.graphicContext=graphicContext;this.datasource=datasource;this.coordinateSystem=coordinateSystem;this.zIdenx=mscg_zIndex.high1ZIndex;this.geo=null;}
ViewStockPrice.prototype.update=function(rect,geo){this.clientRect=rect;this.geo=geo;}
ViewStockPrice.prototype.render=function(){var s=this.datasource.priceChartDatasource.getActualPrices(this.datasource.frequency);var steps=s.steps;var dateArray=s.dateArray;var spPrev=steps[0];var j=steps.length-1;for(var i=0;i<dateArray.length;i++){var sp=steps[i];if(sp==null){j--;continue;}
if(sp.value>spPrev.value){this.graphicContext.setFillStyle(this.zIdenx,'#2736e9');}
else{this.graphicContext.setFillStyle(this.zIdenx,'#de32ae');}
var last=sp.value;var high=sp.getHighValue();var low=sp.getLowValue();var open=sp.openValue;if(this.geo.width-j*4-GRAPH_PADDING<=1){j--;continue;}
this.graphicContext.beginPath(this.zIdenx);this.graphicContext.fillRect(this.zIdenx,this.geo.width-j*4-GRAPH_PADDING,this.coordinateSystem.transformValue(high),2,this.coordinateSystem.transformValue(high)-this.coordinateSystem.transformValue(low));this.graphicContext.fillRect(this.zIdenx,this.geo.width-j*4-GRAPH_PADDING,this.coordinateSystem.transformValue(last),3,2);this.graphicContext.fill(this.zIdenx);spPrev=sp;j--;}}
function ViewStockVolume(graphicContext,coordinateSystem,datasource){this.clientRect=null;this.graphicContext=graphicContext;this.datasource=datasource;this.coordinateSystem=coordinateSystem;this.zIdenx=mscg_zIndex.topZIndex;this.geo=null;}
ViewStockVolume.prototype.update=function(rect,geo){this.clientRect=rect;this.geo=geo;}
ViewStockVolume.prototype.render=function(){var s=this.datasource.priceChartDatasource.getActualVolumes(this.datasource.frequency);var prices=this.datasource.priceChartDatasource.getActualPrices(this.datasource.frequency).steps;var steps=s.steps;if(steps){var dateArray=s.dateArray;var spPrev=prices[0];var j=steps.length-1;this.coordinateSystem.yAxis.physicalStart=20;for(var i=0;i<dateArray.length;i++){var sp=steps[i];var price=prices[i];if(sp==null){j--;continue;}
if(price==undefined){j--;continue;}
if(price.value>spPrev.value){this.graphicContext.setFillStyle(this.zIdenx,'#2736e9');}else{this.graphicContext.setFillStyle(this.zIdenx,'#de32ae');}
var last=sp.value;var high=sp.getMaxValue();var low=sp.getMinValue();if(this.geo.width-j*4-GRAPH_PADDING<=1){j--;continue;}
this.graphicContext.beginPath(this.zIdenx);this.graphicContext.fillRect(this.zIdenx,this.geo.width-j*4-GRAPH_PADDING,this.coordinateSystem.transformValue(last),2,this.coordinateSystem.transformValue(last)-this.geo.y-1);this.graphicContext.fill(this.zIdenx);spPrev=price;j--;}}}
function ViewLine(graphicContext,coordinateSystem,datasource)
{this.clientRect=null;this.graphicContext=graphicContext;this.datasource=datasource;this.coordinateSystem=coordinateSystem;this.strokeStyle="#fe0f0f";this.geo=null;this.zIndex=mscg_zIndex.low3ZIndex;this.visibleSeries=null;}
ViewLine.prototype.update=function(rect,geo)
{this.clientRect=rect;this.geo=geo;}
ViewLine.prototype.render=function(){this.graphicContext.setStrokeStyle(this.zIndex,this.strokeStyle);this.graphicContext.beginPath(this.zIndex);var j=0;for(var i=this.datasource.length-1;i>=0;i--){var sp=this.datasource[i];pointY=this.coordinateSystem.transformValue(sp.value);if(this.geo.width-j*4-GRAPH_PADDING<=1||pointY<=this.geo.y-2){break;}
if(i==this.datasource.length-1){this.graphicContext.moveTo(this.zIndex,this.geo.width-j*4-GRAPH_PADDING,pointY);}
else{this.graphicContext.lineTo(this.zIndex,this.geo.width-j*4-GRAPH_PADDING,pointY);}
j++;}
this.graphicContext.stroke(this.zIndex);}
function ViewRSLine(graphicContext,coordinateSystem,datasource,rsRating){this.clientRect=null;this.graphicContext=graphicContext;this.datasource=datasource;this.coordinateSystem=coordinateSystem;this.geo=null;this.zIndex=mscg_zIndex.low3ZIndex;;this.visibleSeries=null;this.rsRating=rsRating;}
ViewRSLine.prototype.update=function(rect,geo){this.clientRect=rect;this.geo=geo;};ViewRSLine.prototype.render=function(){this.updateDatasource();this.graphicContext.save(this.zIndex);this.graphicContext.setStrokeStyle(this.zIndex,'#2736e9');this.graphicContext.beginPath(this.zIndex);var j=0;for(var i=0;i<this.visibleSeries.length;i++){var sp=this.visibleSeries[i];var pointY=this.coordinateSystem.transformValue(sp.value);if(i==0&&this.rsRating){this.graphicContext.setFillStyle(mscg_zIndex.topZIndex,'#2736e9');this.graphicContext.fillText(mscg_zIndex.topZIndex,this.rsRating,this.geo.width-j*4-GRAPH_PADDING+2,pointY);}
if(this.geo.width-j*4-GRAPH_PADDING<=1){break;}
if(i==this.visibleSeries.length-1){this.graphicContext.moveTo(this.zIndex,this.geo.width-j*4-GRAPH_PADDING,pointY);}else{this.graphicContext.lineTo(this.zIndex,this.geo.width-j*4-GRAPH_PADDING,pointY);}
j++;}
this.graphicContext.stroke(this.zIndex);};ViewRSLine.prototype.updateDatasource=function(){var divisor;if(this.divisor==null){var latestSP=this.datasource[this.datasource.length-1];var lowest=latestSP.price;var tmp;for(var i=this.datasource.length-1;i>=0;i--){tmp=this.datasource[i].price;if(tmp<lowest)lowest=tmp;}
var y=this.coordinateSystem.transformValue(latestSP.price);if(lowest>25)
var shift=(y+this.geo.height)*0.25;else{shift=(y+this.geo.height)*0.05;}
var estimatedPrice=this.coordinateSystem.reverseTransformY(y-shift);divisor=latestSP.price*0.75/estimatedPrice;this.divisor=divisor;}else
divisor=this.divisor;this.visibleSeries=[];for(var i=this.datasource.length-1;i>=0;i--){var sp=this.datasource[i];this.visibleSeries.push(new mscdp_seriesPoint(sp.argument,sp.value/divisor));}};function DataPopup(uiContainer){var datapopup=document.createElement('div');datapopup.setAttribute('style','background: #FFFADD;color:#000000;  border: 1px solid #000000; font-family: Arial; font-size: 8pt;text-decoration: none;  position: absolute; min-width: 120px; opacity: 0.9; z-index:9999;line-height:14px;');datapopup.style.display='none';uiContainer.appendChild(datapopup);var hDiv=document.createElement('div');hDiv.setAttribute('style','position:absolute;width:100%;height:1px; background-color:#2736e9;z-index:9998;');hDiv.style.display='none';hDiv.style.width=uiContainer.offsetWidth-40+'px';uiContainer.appendChild(hDiv);var vDiv=document.createElement('div');vDiv.setAttribute('style','position:absolute;width:1px;background-color:#2736e9;z-index:9998;');vDiv.style.display='none';vDiv.style.height=uiContainer.offsetHeight-16+'px';uiContainer.appendChild(vDiv);var popupContent=document.createDocumentFragment();var date=document.createElement('div');date.style.margin='0 0 0 5px';popupContent.appendChild(date);var high=document.createElement('div');high.style.margin='0 0 0 5px';popupContent.appendChild(high);var low=document.createElement('div');low.style.margin='0 0 0 5px';popupContent.appendChild(low);var last=document.createElement('div');last.style.margin='0 0 0 5px';popupContent.appendChild(last);var vol=document.createElement('div');vol.style.margin='0 0 0 5px';popupContent.appendChild(vol);var closeChangePercent=document.createElement('div');closeChangePercent.style.margin='0 0 0 5px';datapopup.appendChild(popupContent);this.isHidden=true;var MARGIN=10;this.show=function(x,y,data){hDiv.style.top=y-5+'px';vDiv.style.left=x-5+'px';if(this.isHidden){datapopup.style.display='';hDiv.style.display='';vDiv.style.display='';this.isHidden=false;}
if(data.hasData){last.innerHTML='Last: <span id="DataPopupPrice">'+MathCommon.round(data.last,2).toFixed(2)+'</span> <span id="DataPopupPriceChange" style="'+getUDValStyle(data.closeChange)+'">'+'('+formatCloseChange(data.closeChange)+')'+'<span>';date.innerHTML='Date: '+DateUtils.msc_format(data.date,'m/d/Y');high.innerHTML='High: '+MathCommon.round(data.high,2).toFixed(2);low.innerHTML='Low: '+MathCommon.round(data.low,2).toFixed(2);vol.innerHTML='Vol: '+addCommas(data.vol);if(!data.volumeChangePercent)
data.volumeChangePercent=0;closeChangePercent.innerHTML='% Chg vs Avg: '+' <span id="DataPopupPercentChange" style="'+getUDValStyle(data.volumeChangePercent)+'">'+Math.round(data.volumeChangePercent)+'%</span>';}
else{date.innerHTML='Date: ';last.innerHTML='Last: ';high.innerHTML='High: ';low.innerHTML='Low: ';vol.innerHTML='Vol: ';vol.innerHTML='Vol: ';closeChangePercent.innerHTML='% Chg: ';}
x+=MARGIN;y+=MARGIN;var dX=x>uiContainer.offsetWidth-(datapopup.offsetWidth-5)?-(datapopup.offsetWidth+MARGIN*2):0;var dY=y>uiContainer.offsetHeight-(datapopup.offsetHeight)?-(datapopup.offsetHeight+MARGIN*2):0;datapopup.style.top=(y+dY).toString()+'px';datapopup.style.left=(x+dX).toString()+'px';};this.hide=function(){if(!this.isHidden){this.isHidden=true;datapopup.style.display='none';hDiv.style.display='none';vDiv.style.display='none';}};this.update=function(data,priceStart){var currentDate=date.innerHTML.replace('Date: ','');if(currentDate==DateUtils.msc_format(new Date(),'m/d/Y')){var elPrice=$('#DataPopupPrice',last);var diff=0;if(elPrice!=null){diff=BATS.getPriceDifference(elPrice,data.Last.toFixed(2));elPrice.text(MathCommon.round(data.Last,2).toFixed(2));}
var priceChange=(data.Last-priceStart);var elPriceChg=$('#DataPopupPriceChange',last);if(elPriceChg!=null){elPriceChg.html('('+formatCloseChange(priceChange)+')');elPriceChg.css('color',getUDValStyle(priceChange).replace('color:',''));BATS.startHighlight(elPriceChg,diff,'');}}};function getUDValStyle(value){return value==null||value==0?'color:#2736e9':(value>0?'color:#2736e9':'color:#e874c6');}
function formatCloseChange(value){return value==null?'0':((value>0?'+':'')+value.toFixed(2));}}
var LABELS_OFFSET=2;var formatLabel=function(volume){if(volume>=1e9)
return(volume/1e9).toFixed(1)+"B";if(volume>=1e6)
return(volume/1e6).toFixed(1)+"M";if(volume>=10e3)
return(volume/1e3).toFixed(1)+"K";else{return addCommas(volume);}};function ViewAxisLabels(graphicContext,coordinateSystem){this.coordinateSystem=coordinateSystem;this.graphicContext=graphicContext;this.clientRect=null;this.geo=null;this.datasource=null;this.zIndex=mscg_zIndex.textZIndex;};ViewAxisLabels.prototype.update=function(rect,geo){this.clientRect=rect;this.geo=geo;};ViewAxisLabels.prototype.render=function(volHeight){this.graphicContext.setTextAlign(this.zIndex,"left");this.graphicContext.setTextBaseline(this.zIndex,"middle");this.graphicContext.setFont(this.zIndex,'12px sans-serif');this.graphicContext.setFillStyle(this.zIndex,"#808285");this.graphicContext.setStrokeStyle(mscg_zIndex.low1ZIndex,"#d4d4d4");this.graphicContext.setLineDash(mscg_zIndex.low1ZIndex,[1,2]);this.graphicContext.beginPath(mscg_zIndex.low1ZIndex);if(this.coordinateSystem.yAxis.isLogarithmic){var axisCountFactor=Math.floor(0.08*this.geo.height);var minVal=MathCommon.linearizeLog10(this.clientRect.minValue);var maxVal=MathCommon.linearizeLog10(this.clientRect.maxValue);var diff=maxVal-minVal;var step=diff/axisCountFactor;this.graphicContext.setFont(this.zIndex,'9px sans-serif');if(step!=0)
for(var i=minVal+(step/4);i<=maxVal-(step/4);i+=step){var linearVal=MathCommon.deLinearizeLog10(i);this.graphicContext.fillText(this.zIndex,formatLabel(linearVal),this.geo.width+LABELS_OFFSET,this.coordinateSystem.transformValue(linearVal));this.graphicContext.moveTo(mscg_zIndex.low1ZIndex,this.geo.width-1,this.coordinateSystem.transformValue(linearVal));this.graphicContext.lineTo(mscg_zIndex.low1ZIndex,0,this.coordinateSystem.transformValue(linearVal));this.graphicContext.stroke(mscg_zIndex.low1ZIndex);}}
else{var realDiff=this.clientRect.maxValue-this.clientRect.minValue;var roundFactor=0;axisCountFactor=Math.floor(0.05*this.geo.height);if(realDiff>0&&realDiff<=15)roundFactor=1;if(realDiff>15&&realDiff<=50)roundFactor=5;if(realDiff>50&&realDiff<=100)roundFactor=10;if(realDiff>100)roundFactor=100;minVal=Math.round(this.clientRect.minValue/roundFactor)*roundFactor;maxVal=Math.ceil(this.clientRect.maxValue/roundFactor)*roundFactor;diff=maxVal-minVal;step=Math.round(diff/axisCountFactor);if(axisCountFactor>diff)
step=1;if(step>50)
{step=Math.round(step/roundFactor)*roundFactor;}
if(step!=0)
for(var i=minVal;i<maxVal;i+=step){if(i<=this.clientRect.minValue)continue;if(i>=this.clientRect.maxValue)continue;if(this.coordinateSystem.transformValue(i)>=this.geo.y+this.geo.height-6)continue;if(this.coordinateSystem.transformValue(i)<=this.geo.y+4)continue;this.graphicContext.fillText(this.zIndex,formatLabel(i),this.geo.width+LABELS_OFFSET,this.coordinateSystem.transformValue(i));this.graphicContext.moveTo(mscg_zIndex.low1ZIndex,this.geo.width-1,this.coordinateSystem.transformValue(i));this.graphicContext.lineTo(mscg_zIndex.low1ZIndex,0,this.coordinateSystem.transformValue(i));}}
if(volHeight){var s=this.datasource.priceChartDatasource.getActualPrices(this.datasource.frequency);var skipMonths=0;if(this.datasource.frequency==2){skipMonths=3;}
var skipIndicator=0;var actualSteps=s.steps;var dateArray=s.dateArray;for(var i=this.geo.width;i>0;i-=20){this.graphicContext.moveTo(mscg_zIndex.low1ZIndex,i-GRAPH_PADDING,this.geo.y-volHeight);this.graphicContext.lineTo(mscg_zIndex.low1ZIndex,i-GRAPH_PADDING,this.geo.y+this.geo.height);}
this.graphicContext.stroke(mscg_zIndex.low1ZIndex);this.graphicContext.beginPath(mscg_zIndex.low1ZIndex);this.graphicContext.beginPath(mscg_zIndex.low2ZIndex);this.graphicContext.setLineDash(mscg_zIndex.low1ZIndex,[1,1]);this.graphicContext.setLineWidth(mscg_zIndex.low1ZIndex,1);this.graphicContext.setStrokeStyle(mscg_zIndex.low1ZIndex,"#cccccc");this.graphicContext.setTextAlign(this.zIndex,"left");var j=this.geo.width;if(actualSteps[actualSteps.length-1])
var currMonth=actualSteps[actualSteps.length-1].argument.getMonth();else{var currMonth=actualSteps[actualSteps.length-2].argument.getMonth();}
this.graphicContext.restore(this.zIndex);for(var i=actualSteps.length-1;i>=0;i--){if(actualSteps[i]==null)continue;if(currMonth!=actualSteps[i].argument.getMonth()){if(skipIndicator==skipMonths){this.graphicContext.moveTo(mscg_zIndex.low1ZIndex,j-GRAPH_PADDING+4,this.geo.y-volHeight);this.graphicContext.lineTo(mscg_zIndex.low1ZIndex,j-GRAPH_PADDING+4,this.geo.y+this.geo.height);this.graphicContext.moveTo(mscg_zIndex.low2ZIndex,j-GRAPH_PADDING+4,this.geo.y-volHeight-15);this.graphicContext.lineTo(mscg_zIndex.low2ZIndex,j-GRAPH_PADDING+4,this.geo.y-volHeight);var month=actualSteps[i+1]||actualSteps[i];if(j-GRAPH_PADDING+8>this.geo.x)
this.graphicContext.fillText(this.zIndex,msccut_utilsDate.getMonthName(currMonth+1,true),j-GRAPH_PADDING+8,this.geo.y-volHeight-7);skipIndicator=0;}
if(skipIndicator!=skipMonths){skipIndicator++;}}
j-=4;currMonth=actualSteps[i].argument.getMonth();}}
this.graphicContext.stroke(mscg_zIndex.low1ZIndex);this.graphicContext.stroke(mscg_zIndex.low2ZIndex);};var mscg_zIndex=new function(){this.low1ZIndex=0;this.low2ZIndex=1;this.low3ZIndex=2;this.high1ZIndex=3;this.high2ZIndex=4;this.textZIndex=5;this.topZIndex=6;this.maxZIndexCount=7;};function GraphicContextHtml5(container){var layers=null;var canvases=null;var onMouseDownListeners=[];this.offsetWidth=null;this.offsetHeight=null;this.getType=function(){return"HTML5";};this.init=function(){layers=[];canvases=[];for(var i=0;i<mscg_zIndex.maxZIndexCount;i++){var canvas=document.createElement('canvas');canvas.style.position='absolute';canvas.style.zIndex=(i+1).toString();container.appendChild(canvas);canvases.push(canvas);layers.push(canvas.getContext('2d'));}};this.update=function(){var height=container.offsetHeight;var width=container.offsetWidth;if(!height){height=parseInt(container.style.height.replace('px',''));}
if(!width){width=parseInt(container.style.width.replace('px',''));}
this.offsetWidth=width;this.offsetHeight=height;for(var i=0;i<mscg_zIndex.maxZIndexCount;i++){layers[i].canvas.width=this.offsetWidth;layers[i].canvas.height=this.offsetHeight;}};this.saveGraphicContext=function(){for(var i=0;i<mscg_zIndex.maxZIndexCount;i++){layers[i].save();}};this.restoreGraphicContext=function(){for(var i=0;i<mscg_zIndex.maxZIndexCount;i++){layers[i].restore();}};this.clearGraphicContext=function(left,top,w,h){for(var i=0;i<mscg_zIndex.maxZIndexCount;i++){layers[i].clearRect(left,this.offsetHeight-top,w,h);}};this.clearLayer=function(layer){canvases[layer].width=canvases[layer].width;};this.onMouseDown=function(layer,callback,sender){if(canvases[canvases.length-1].addEventListener){canvases[canvases.length-1].addEventListener("mousedown",function(e){callback({x:e.offsetX?e.offsetX:e.layerX,y:this.offsetHeight-(e.offsetY?e.offsetY:e.layerY)},sender);});}else if(canvases[canvases.length-1].attachEvent){canvases[canvases.length-1].attachEvent("onmousedown",function(e){callback({x:e.offsetX?e.offsetX:e.layerX,y:this.offsetHeight-(e.offsetY?e.offsetY:e.layerY)},sender);});}};this.onMouseMove=function(layer,callback,sender){if(canvases[canvases.length-1].addEventListener){canvases[canvases.length-1].addEventListener("mousemove",function(e){callback({x:e.offsetX?e.offsetX:e.layerX,y:this.offsetHeight-(e.offsetY?e.offsetY:e.layerY)},sender);});}else if(canvases[canvases.length-1].attachEvent){canvases[canvases.length-1].attachEvent("onmousemove",function(e){callback({x:e.offsetX?e.offsetX:e.layerX,y:this.offsetHeight-(e.offsetY?e.offsetY:e.layerY)},sender);});}};this.createPattern=function(layer,image,repetition){return layers[layer].createPattern(image,repetition);};this.save=function(layer){layers[layer].save();};this.restore=function(layer){layers[layer].restore();};this.clearRect=function(layer,left,top,w,h){layers[layer].clearRect(left,this.offsetHeight-top,w,h);};this.fillRect=function(layer,left,top,w,h){layers[layer].fillRect(left,this.offsetHeight-top,w,h);};this.strokeRect=function(layer,left,top,w,h){layers[layer].strokeRect(left,this.offsetHeight-top,w,h);};this.beginPath=function(layer){layers[layer].beginPath();};this.closePath=function(layer){layers[layer].closePath();};this.moveTo=function(layer,x,y){if(layers[layer].lineWidth<=1){x=Math.round(x)+0.5;y=Math.round(y)+0.5;}
if(layers[layer].lineWidth==2){x=Math.round(x);y=Math.round(y);}
layers[layer].moveTo(x,this.offsetHeight-y);};this.lineTo=function(layer,x,y){if(layers[layer].lineWidth<=1){x=Math.round(x)+0.5;y=Math.round(y)+0.5;}
if(layers[layer].lineWidth==2){x=Math.round(x);y=Math.round(y);}
layers[layer].lineTo(x,this.offsetHeight-y);};this.rect=function(layer,left,top,w,h){layers[layer].rect(left,this.offsetHeight-top,w,h);};this.fill=function(layer){layers[layer].fill();};this.stroke=function(layer){layers[layer].stroke();};this.clip=function(layer,left,top,w,h){layers[layer].rect(left,this.offsetHeight-top,w,h);layers[layer].clip();};this.isPointInPath=function(layer,x,y){layers[layer].isPointInPath(x,this.offsetHeight-y);};this.setAntiAliasing=function(layer,turnOn){};this.setLineWidth=function(layer,lineWidth){layers[layer].lineWidth=lineWidth;};this.getLineWidth=function(layer,lineWidth){return layers[layer].lineWidth;};this.setLineCap=function(layer,lineCap){layers[layer].lineCap=lineCap;};this.getLineCap=function(layer,lineCap){return layers[layer].lineCap;};this.setLineJoin=function(layer,lineJoin)
{layers[layer].lineJoin=lineJoin;}
this.getLineJoin=function(layer,lineJoin){return layers[layer].lineJoin;};this.setMiterLimit=function(layer,lineWidth){layers[layer].miterLimit=miterLimit;};this.getMiterLimit=function(layer,lineWidth){return layers[layer].miterLimit;};this.setStrokeStyle=function(layer,strokeStyle,dashPattern,dashStrokeStyle){layers[layer].strokeStyle=strokeStyle;};this.getStrokeStyle=function(layer,strokeStyle){return layers[layer].strokeStyle;};this.setFillStyle=function(layer,fillStyle){layers[layer].fillStyle=fillStyle;};this.getFillStyle=function(layer,fillStyle){return layers[layer].fillStyle;};this.setFont=function(layer,font){layers[layer].font=font;};this.getFont=function(layer,font){return layers[layer].font;};this.setTextAlign=function(layer,textAlign){layers[layer].textAlign=textAlign;};this.getTextAlign=function(layer,textAlign){return layers[layer].textAlign;};this.setTextBaseline=function(layer,textAlign){layers[layer].textBaseline=textAlign;};this.getTextBaseline=function(layer,textAlign){return layers[layer].textBaseline;};this.fillText=function(layer,text,x,y,maxWidth){if(maxWidth){layers[layer].fillText(text,x,this.offsetHeight-y,maxWidth);}else{layers[layer].fillText(text,x,this.offsetHeight-y);}};this.strokeText=function(layer,text,x,y,maxWidth){if(maxWidth){layers[layer].strokeText(text,x,this.offsetHeight-y,maxWidth);}else{layers[layer].strokeText(text,x,this.offsetHeight-y);}};this.measureText=function(layer,text){layers[layer].measureText(text);};this.setLineDash=function(layer,args){if(layers[layer].setLineDash)
layers[layer].setLineDash(args);else if(args!=[1,1]){layers[layer].strokeStyle='#d3d3d3';layers[layer].lineWidth=0.5;}
else{}}}
GRAPH_PADDING=5;var hMouseMove=false;function MiniChart(cnt){this.domElement=cnt;var xPadding=44;var yPadding=40;var volPadding=15;var height=cnt.offsetHeight;var width=cnt.offsetWidth;if(!height){height=parseInt(cnt.style.height.replace('px',''));}
if(!width){width=parseInt(cnt.style.width.replace('px',''));}
yPadding=(height-volPadding)*20.8/100+volPadding;this.priceChartGeo={width:width-xPadding,height:height-yPadding,y:yPadding,x:0};this.volumeChartGeo={width:width-xPadding,height:(height-volPadding)*20.8/100,y:volPadding,x:0};}
MiniChart.prototype.showChart=function(options){var datasource=new mscdp_basicChartDatasource();var graphicContext=new GraphicContextHtml5(this.domElement);var datasourceRS=null;var dataPopup=null;var dp=new mscdp_dataProvider('/services/ChartService.svc',datasource,function(){this.domElement.innerHTML='';if(datasource.error){this.domElement.innerHTML='<div style="font-family:arial;font-size:12px;text-align:center;padding:2px;color:#ffffff;background-color:#1a81d3">'+datasource.error.errMsg+'</div>';return;}
if(datasource.priceChartDatasource.priceSeries.length<datasource.priceChartDatasource.cutCount)datasource.priceChartDatasource.cutCount=0;if(options.freq==mscdp_chartFrequency.daily)
var movAvg1Step=50;if(options.freq==mscdp_chartFrequency.weekly)
movAvg1Step=10;var movingAvg=datasource.priceChartDatasource.getPriceAverageDatasource(movAvg1Step);var movingAvgCount=movingAvg.length;var maxmin=datasource.priceChartDatasource.getMaxMinPrices(movingAvgCount*4<=this.priceChartGeo.width);var maxminVol=datasource.getMaxMin(datasource.priceChartDatasource.volumeSeries.slice(datasource.priceChartDatasource.cutCount));this.clientRect={maxValue:maxmin.max,minValue:maxmin.min};this.clientRectVol={maxValue:maxminVol.max,minValue:maxminVol.min};graphicContext.init();graphicContext.update();var xAxis=new Axis(this.clientRect,this.priceChartGeo);var yAxis=new Axis(this.clientRect,this.priceChartGeo);var xAxisVol=new Axis(this.clientRectVol,this.volumeChartGeo);var yAxisVol=new Axis(this.clientRectVol,this.volumeChartGeo);yAxisVol.isLogarithmic=true;var coordSystem=new CoordinateSystem(xAxis,yAxis);var coordSystemVol=new CoordinateSystem(xAxisVol,yAxisVol);if(options.showRS&&options.showRS!="false"&&options.showRS!="False"&&options.showRS!="0"){datasourceRS=datasource.createDatasourceRS();GRAPH_PADDING=15;var viewRS=new ViewRSLine(graphicContext,coordSystem,datasourceRS,datasource.priceChartDatasource.rSRating);viewRS.update(this.clientRect,this.priceChartGeo);viewRS.updateDatasource();var maxminRS=datasource.getMaxMin(viewRS.visibleSeries);if(maxmin.min>maxminRS.min)maxmin.min=maxminRS.min;if(maxmin.max<maxminRS.max)maxmin.max=maxminRS.max;this.clientRect.minValue=maxmin.min;this.clientRect.maxValue=maxmin.max;yAxis.refresh(this.clientRect,this.priceChartGeo);viewRS.render();}else{GRAPH_PADDING=5;}
var viewAxisLabels=new ViewAxisLabels(graphicContext,coordSystem);var viewAxisLabelsVol=new ViewAxisLabels(graphicContext,coordSystemVol);var viewStockPrice=new ViewStockPrice(graphicContext,coordSystem,datasource);var viewStockVolume=new ViewStockVolume(graphicContext,coordSystemVol,datasource);var viewMovAvg50=new ViewLine(graphicContext,coordSystem,movingAvg);var viewMovAvg50Vol=new ViewLine(graphicContext,coordSystemVol,datasource.priceChartDatasource.getVolumeAverageDatasource(movAvg1Step,true,false));if(options.callback){window[options.callback](datasource,null);}
graphicContext.setLineWidth(mscg_zIndex.low2ZIndex,1);graphicContext.setStrokeStyle(mscg_zIndex.low2ZIndex,'#333');graphicContext.beginPath(mscg_zIndex.low2ZIndex);graphicContext.moveTo(mscg_zIndex.low2ZIndex,this.priceChartGeo.width,this.domElement.offsetHeight);graphicContext.moveTo(mscg_zIndex.low2ZIndex,this.domElement.offsetWidth-1,this.priceChartGeo.y);graphicContext.lineTo(mscg_zIndex.low2ZIndex,0,this.priceChartGeo.y);graphicContext.moveTo(mscg_zIndex.low2ZIndex,this.domElement.offsetWidth-1,this.volumeChartGeo.y);graphicContext.lineTo(mscg_zIndex.low2ZIndex,0,this.volumeChartGeo.y);graphicContext.lineTo(mscg_zIndex.low2ZIndex,0,this.domElement.offsetHeight-1);graphicContext.lineTo(mscg_zIndex.low2ZIndex,this.domElement.offsetWidth-1,this.domElement.offsetHeight-1);graphicContext.lineTo(mscg_zIndex.low2ZIndex,this.domElement.offsetWidth-1,0);graphicContext.lineTo(mscg_zIndex.low2ZIndex,0,0);graphicContext.lineTo(mscg_zIndex.low2ZIndex,0,this.volumeChartGeo.y);graphicContext.stroke(mscg_zIndex.low2ZIndex);viewAxisLabels.datasource=datasource;viewAxisLabelsVol.datasource=datasource;viewAxisLabels.update(this.clientRect,this.priceChartGeo);viewAxisLabelsVol.update(this.clientRectVol,this.volumeChartGeo);viewStockPrice.update(this.clientRect,this.priceChartGeo);viewStockVolume.update(this.clientRectVol,this.volumeChartGeo);viewMovAvg50.update(this.clientRect,this.priceChartGeo);viewMovAvg50Vol.update(this.clientRectVol,this.volumeChartGeo);viewAxisLabels.render(this.volumeChartGeo.height);viewAxisLabelsVol.render();viewStockPrice.render();viewMovAvg50.render();viewMovAvg50Vol.render();viewStockVolume.render();dataPopup=new DataPopup(this.domElement);this.domElement.addEventListener('touchstart',onMouseStart.bind(this),false);this.domElement.addEventListener('touchmove',onMouseMove.bind(this),false);this.domElement.addEventListener('touchend',onMouseOut,false);this.domElement.addEventListener('mousemove',onMouseMove.bind(this),false);this.domElement.addEventListener('mouseleave',onMouseOut.bind(this),false);function onMouseStart(e){hMouseMove=false;}
function onMouseMove(e){hMouseMove=true;if(e.touches){e.preventDefault();e=e.touches[0];}
var rect=this.domElement.getBoundingClientRect();var scrollTop=document.documentElement.scrollTop||document.body.scrollTop;var scrollLeft=document.documentElement.scrollLeft||document.body.scrollLeft;var x=e.pageX-rect.left-scrollLeft+4,y=e.pageY-rect.top-scrollTop+4;if(x<=this.priceChartGeo.width-GRAPH_PADDING+8&&y<=(this.priceChartGeo.height+this.volumeChartGeo.height)&&x>=this.priceChartGeo.x+6&&y>=6){var data=getPopupData.call(this,x,y);dataPopup.show(x,y,data);}}
function onMouseOut(e){var x,y;dataPopup.hide();}
function getPopupData(x,y){var steps=datasource.priceChartDatasource.getActualPrices(datasource.frequency).steps;var vols=datasource.priceChartDatasource.getActualVolumes(datasource.frequency).steps;var disFromRight=this.priceChartGeo.width-GRAPH_PADDING+6-x;disFromRight=Math.round(disFromRight/4);var data={};var sp=steps[steps.length-1-disFromRight];var spPrev=steps[steps.length-1-disFromRight-1];if(spPrev==null){spPrev=steps[steps.length-1-disFromRight-2];}
if(vols){var volumeIndex=vols.length-1-disFromRight;var vol=vols[volumeIndex];var volPrev=vols[volumeIndex-1];if(volPrev==null){volPrev=vols[volumeIndex-2];}
var averageVolFactor=1;var volumeAverage=datasource.priceChartDatasource.getVolumeAverageDatasource(movAvg1Step,true,true);var volumeAverageIndex=volumeAverage.length-(vols.length-volumeIndex);if(volumeAverageIndex>=0){var avgVolSp=volumeAverage[volumeAverageIndex];var averageVol=averageVolFactor*avgVolSp.value;if(volumeIndex==vols.length-1&&options.freq==mscdp_chartFrequency.daily){data.volumeChangePercent=100*(vol.value*datasource.companyInfo.dayRate-averageVol)/averageVol;}else if(volumeIndex==vols.length-1&&options.freq==mscdp_chartFrequency.weekly){data.volumeChangePercent=datasource.companyInfo.dayRate;}else{data.volumeChangePercent=100*(vol.value-averageVol)/averageVol;}}}
if(sp==null){data.hasData=false;}
else{data.last=sp.value;data.date=sp.argument;data.high=sp.getMaxValue();data.low=sp.getMinValue();if(vol)
data.vol=vol.value;else{data.vol=0;}
if(spPrev!=undefined){data.closeChange=sp.value-spPrev.value;data.closeChangePercent=sp.value!=0?100*data.closeChange/spPrev.value:"NaN";}
else{data.closeChange=sp.value;data.closeChangePercent="N/A";}
data.hasData=true;}
return data;};}.bind(this));var date=getStartDate(this.priceChartGeo.width);dp.loadChartData(options.symbol,date.from,date.to,options.freq,1,1,true);function getStartDate(width){width=width-GRAPH_PADDING;var count=Math.ceil(width/2.1)+2;var to=new Date();if(options.freq==mscdp_chartFrequency.weekly){count=count*3.5;datasource.priceChartDatasource.cutCount=35;count=count+datasource.priceChartDatasource.cutCount*8;}
if(options.freq==mscdp_chartFrequency.daily){count=count-Math.round(count/7);datasource.priceChartDatasource.cutCount=55;count=count+datasource.priceChartDatasource.cutCount+13;}
var d=new Date(to);d.setDate(d.getDate()-(count));var from=d.getFullYear()+'-'+(d.getMonth()+1)+'-'+d.getDate();return{from:from,to:to};}
if(typeof(BATS)!='undefined'){BATS.addEnableFunc(checkForBATS);BATS.addReceiveFunc(SetPriceChanges);}
function checkForBATS(){if(typeof(BATS)!='undefined'&&BATS.Enabled){if(BATS.isConnected()){BATS.subscribe(options.symbol);}else{setTimeout(checkForBATS,1000);}}}
function unsubscribeBATS(){if(typeof(BATS)!='undefined'&&BATS.Enabled){if(BATS.isConnected()){BATS.unsubscribe(options.symbol);}}}
function SetPriceChanges(data){if(datasource!=null&&datasource.summary!=null&&datasource.summary.source!="IDCCLOSE"){if(jQuery.trim(data.Symbol.toLowerCase())==jQuery.trim(options.symbol.toLowerCase())){var priceSeries=datasource.priceChartDatasource.priceSeries;priceSeries[priceSeries.length-1].updateValue(data);var priceStart=priceSeries[priceSeries.length-2].value;dataPopup.update(data,priceStart);if(options.callback){window[options.callback](datasource,data);}}}}};function showMiniChart(className){var cnts=document.querySelectorAll(className);show();function show(){for(var i=0;i<cnts.length;i++){var cnt=cnts[i];var chart=new MiniChart(cnt);chart.showChart({symbol:decodeURIComponent(cnt.getAttribute('data-symbol')),freq:mscdp_chartFrequency[cnt.getAttribute('data-freq')],showRS:cnt.getAttribute('data-rs'),callback:cnt.getAttribute('data-callback')});}}
setInterval(function(){show();},120000);}